!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("d3")):"function"==typeof define&&define.amd?define(["exports","d3"],t):t(e.hierarchyExplorer={},e.d3)}(this,function(e,I){"use strict";var l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},D=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],i=!0,a=!1,o=void 0;try{for(var l,r=e[Symbol.iterator]();!(i=(l=r.next()).done)&&(n.push(l.value),!t||n.length!==t);i=!0);}catch(e){a=!0,o=e}finally{try{!i&&r.return&&r.return()}finally{if(a)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};function r(n,i,a,o){var l=a.debugOn;if(n.fromFile)n.data.endsWith(".json")?I.json(n.data).then(function(e){l&&(console.log("Initial Data: "),console.log(e));var t=I.hierarchy(e);l&&(console.log("hierarchy: "),console.log(t)),o(i,t)}):n.data.endsWith(".csv")?I.dsv(n.delimiter,n.data).then(function(e){l&&console.log(e),n.flatData&&(e=c(e,n.hierarchyLevels,n.keyField,n.delimiter,n.separator,a));var t=d(e,n.keyField);l&&(console.log("hierarchy: "),console.log(t)),o(i,t)}):console.log("File must end with .json or .csv");else{var e=void 0;if(n.isJSON)e=I.hierarchy(n.data);else{var t=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"aside#data",n=I.select(t).text().trim();return I.dsvFormat(e).parse(n)}(n.delimiter,n.data);n.flatData&&(t=c(t,n.hierarchyLevels,n.keyField,n.delimiter,n.separator,a)),e=d(t,n.keyField),l&&(console.log("embedded data: "),console.log(e))}o(i,e)}}function d(e,t){return I.stratify().id(function(e){return e[t]}).parentId(function(e){return e.parent})(e)}function W(e,t,n,i,a){var o=function(e,t,n,i){for(var a=1===n?t[0]:e[t[n-1]],o=0;o<n;o++)0===o?a=t[0]:a+=i+e[t[o]];return a}(e,t,n,a);return o+i+(o+a+e[t[n]])}function c(e,i,t,a,o,n){function l(e){return function(t,n){return Object.keys(t).forEach(function(e){return t[e]=n})}(e,"")}var r,d=n.debugOn,c=n.nodeLabelFieldFlatData,g=void 0,u=new Map,s=void 0,h=void 0,f=void 0,p=!0;e.forEach(function(n){p=!0,i.forEach(function(e,t){0<t&&p&&(h={},n[e]&&(console.log("!row[key]"),console.log(n),console.log(e)),t===i.length-1?(s=W(n,i,t,a,o),u.get(s)||(Object.assign(h,n),h[c]=n[e],u.set(s,h))):(s=W(n,i,t,a,o),n[i[t+1]]?u.get(s)||(Object.assign(h,n),l(h),h[c]=n[e],u.set(s,h)):(Object.assign(h,n),h[c]=n[e],u.set(s,h),p=!1)))})}),d&&console.log(u),f="parent"+a+t,Object.keys(e[0]).forEach(function(e){f+=a+e}),g=(f+=a+c)+"\n",f=a+i[0]+a,f+=a.repeat(Object.keys(e[0]).length),i[0]!==o&&(f+=i[0]),g+=f+"\n";var k=!0,m=!1,y=void 0;try{for(var L,v=u[Symbol.iterator]();!(k=(L=v.next()).done);k=!0){var b=L.value,S=D(b,2),x=S[0],F=S[1];f=x,Object.values(F).forEach(function(e){f+=a+e}),g+=f+"\n"}}catch(e){m=!0,y=e}finally{try{!k&&v.return&&v.return()}finally{if(m)throw y}}return d&&(console.log("converted linked Data:"),console.log(g)),r=I.dsvFormat(a).parse(g),d&&(console.log("converted linked Data array:"),console.log(r)),r}var L={},g=void 0,o=void 0,u=void 0,t=void 0;L.initialize=function(e){o=u,u=(g=e).linkLabelOn?g.linkLabelField:void 0,g.debugOn&&(console.log("oldLabel:"),console.log(o),console.log("newLabel:"),console.log(u))},L.getLinkD=function(e,t){var n=L.getLinkStrength(e.parent,g),i=L.getLinkStrength(e,g),a=void 0;return"down"===t?a="M 0 "+-1*Math.floor(n/2)+" V"+(e.x+i/2-e.parent.x):"right"===t&&(a="M 0 0H"+(e.y-(e.parent.y+n/2))),a},L.getDy=function(e){return g.linkLabelOnTop?"0.35em":Math.ceil(-.5*L.getLinkStrength(e)-3)},L.getInitialDy=function(){return I.select(this).attr("dy")?g.linkLabelOnTop?I.select(this).attr("dy").endsWith("em")?I.select(this).attr("dy"):"0.35em":I.select(this).attr("dy").endsWith("em")?0:I.select(this).attr("dy"):null},L.getLinkStrength=function(e){return e.data?g.linkStrengthStatic?g.linkStrengthValue:g.linkStrengthScale(e.data[g.linkStrengthField]):0},L.getLinkStroke=function(e){return g.linkColorStatic?g.defaultColor:g.linkColorScale(e.data[g.linkColorField])},L.getLinkStrokeWidth=function(e){return L.getLinkStrength(e)+"px"},L.getLinkLabel=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:g.linkLabelField;return g.linkLabelOn?e.data[t]:""},L.getLinkLabelFormatted=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:g.linkLabelField;return g.linkLabelOn?isNaN(e.data[t])?e.data[t]:g.linkLabelFormat(e.data[t])+g.linkLabelUnit:""},L.getLinkTextTween=function(e){var t=I.select(this);if(!g.linkLabelOn)return function(){t.text("")};var n=L.getLinkLabel(e,o),i=L.getLinkLabel(e,u);if(isNaN(n)||isNaN(i))return function(){t.text(i)};var a=I.interpolateNumber(n,i);return function(e){t.text(g.linkLabelFormat(a(e))+g.linkLabelUnit)}},L.getLinkRTranslate=function(e){return"translate("+L.getLinkStrength(e.parent)/2+" "+(e.x-e.parent.x)+")"},L.getLinkLabelColor=function(e){return g.linkLabelColor?g.linkLabelColor(L.getLinkLabel(e,o)):I.select(this).style("fill")},L.getLinkTextPositionX=function(e){return g.linkLabelAligned?t.get(e.depth).posXCenter+t.get(e.depth).maxX/2:(e.y-e.parent.y)/2},L.computeLabelDimensions=function(e){var o=new Map;e.each(function(e){var t={},n=I.select(this).node().getBBox().height,i=I.select(this).node().getBBox().width,a=I.select(this).text();o.get(e.depth)?((t=o.get(e.depth)).maxX<i&&(t.maxX=i,t.maxXText=a),t.posXCenter>(e.y-e.parent.y)/2&&(t.posXCenter=(e.y-e.parent.y)/2),t.maxY<n&&(t.maxY=n,t.maxYText=a)):(t.maxX=i,t.minX=i,t.maxY=n,t.maxXText=a,t.maxYText=a,t.posXCenter=(e.y-e.parent.y)/2),o.set(e.depth,t)}),t=o,g.debugOn&&(console.log("dimensions:"),console.log(o))};var v={},n=void 0;function s(e,t,n){var i={};i.width=n.svgDimensions.width-n.margin.right-n.margin.left,i.height=n.svgDimensions.height-n.margin.top-n.margin.bottom,i.i=0,i.tree=void 0,i.root=void 0,i.svg=void 0,i.counter=0,i.labelDimensions=[],i.svg=e.append("svg").attr("width",i.width+n.margin.right+n.margin.left).attr("height",i.height+n.margin.top+n.margin.bottom).append("g").attr("transform","translate("+n.margin.left+","+n.margin.top+")"),a(n,i,t),h(n,i),function(e,t,n){e.updateLinkWidth=function(){e.linkWidthStatic?t.tree.nodeSize([0,e.linkWidthValue]):h(e,t),b(t.root,e,t)},e.updateLinkStrength=function(){h(e,t),b(t.root,e,t)},e.updateAlignLeaves=function(){a(e,t,n),b(t.root,e,t)},e.updateDefault=function(){b(t.root,e,t)}}(n,i,t),b(i.root,n,i)}function a(t,n,e){n.tree=t.alignLeaves?I.cluster():I.tree(),n.tree.size([n.width,n.height]).nodeSize([0,t.linkWidthValue]),n.root=n.tree(e),t.propagate&&n.root.sum(function(e){return e[t.propagateField]}),n.root.each(function(e){e.name=e.id,e.id=n.i,n.i++,t.propagate&&(e.data[t.propagateField]=e.value)}),n.root.x0=n.root.x,n.root.y0=n.root.y,t.propagate&&(t.propagate=!1),t.debugOn&&(console.log("Data:"),console.log(e),console.log("Tree:"),console.log(n.root))}function h(t,e){var n=e.root.descendants();t.linkStrengthStatic||t.linkStrengthScale.domain(I.extent(n,function(e){return+e.data[t.linkStrengthField]})).range(t.linkStrengthRange),t.linkWidthStatic||t.linkWidthScale.domain(I.extent(n.slice(1),function(e){return+e.data[t.linkWidthField]})).range(t.linkWidthRange)}function b(e,n,t){var i=t.tree(t.root),a=[];i.eachBefore(function(e){a.push(e)}),t.height=Math.max(500,a.length*n.linkHeight+n.margin.top+n.margin.bottom);var o=a.slice(1);a.forEach(function(e,t){e.x=t*n.linkHeight,n.linkWidthStatic||0!==t&&(e.y=e.parent.y+n.linkWidthScale(+e.data[n.linkWidthField]))}),I.select("svg").transition().duration(n.transitionDuration).attr("height",t.height);var l=v;l.initialize(n);var r=t.svg.selectAll("g.node").data(a,function(e){return e.id||(e.id=++t.i)}),d=r.enter().append("g").attr("class","node").attr("transform",function(){return"translate("+e.y0+","+e.x0+") scale(0.001, 0.001)"}).on("click",function(e){return function(e,t,n){e.children?(e._children=e.children,e.children=null):(e.children=e._children,e._children=null),b(e,t,n)}(e,n,t)});d.call(l.appendNode),d.append("text").attr("class","nodeLabel").attr("x",n.nodeLabelPadding).attr("dy",".35em").attr("text-anchor","start").text(function(e){return e.data[n.nodeLabelField].length>n.nodeLabelLength?e.data[n.nodeLabelField].substring(0,n.nodeLabelLength)+"...":e.data[n.nodeLabelField]}).style("fill-opacity",1e-6),d.append("svg:title").text(function(e){return e.data[n.nodeLabelField]});var c=r.merge(d).transition().duration(n.transitionDuration);c.attr("transform",function(e){return"translate("+e.y+","+e.x+") scale(1,1)"}),c.call(l.updateNode),c.select(".nodeLabel").style("fill-opacity",1);var g=r.exit().transition().duration(n.transitionDuration);g.attr("transform",function(){return"translate("+e.y+","+e.x+") scale(0.001, 0.001)"}).remove(),g.select(".nodeLabel").style("fill-opacity",1e-6);var u=L;u.initialize(n);var s=t.svg.selectAll("g.link").data(o,function(e){return e.id+"->"+e.parent.id}),h=s.enter().insert("g","g.node").attr("class","link").attr("transform","translate("+e.y0+" "+e.x0+")"),f={x:e.x0,y:e.y0,parent:{x:e.x0,y:e.y0}};h.filter(function(e){return e.id===e.parent.children[e.parent.children.length-1].id}).append("path").attr("class","link down").attr("d",function(){return u.getLinkD(f,"down")}),h.append("path").attr("class","link right").attr("d",function(){return u.getLinkD(f,"right")}),h.append("text").style("opacity",1e-6);var p=s.merge(h);p.select("text").attr("class",n.linkLabelOnTop?"label ontop":"label above").attr("text-anchor",n.linkLabelAligned?"end":"middle").attr("dy",u.getInitialDy).text(function(e){return u.getLinkLabelFormatted(e)}).style("fill",u.getLinkLabelColor);var k=p.transition().duration(n.transitionDuration);u.computeLabelDimensions(I.selectAll(".link text.label")),k.attr("transform",function(e){return"translate("+e.parent.y+" "+e.parent.x+")"}),k.select("path.link.down").attr("d",function(e){return u.getLinkD(e,"down")}).style("stroke",function(e){return n.linkColorInherit?u.getLinkStroke(e.parent):""}).style("stroke-width",function(e){return u.getLinkStrokeWidth(e.parent)}),k.select("path.link.right").attr("d",function(e){return u.getLinkD(e,"right")}).attr("transform",u.getLinkRTranslate).style("stroke",u.getLinkStroke).style("stroke-width",u.getLinkStrokeWidth),k.select("text").attr("dy",u.getDy).attr("x",u.getLinkTextPositionX).attr("y",function(e){return e.x-e.parent.x}).call(function(e){return e.tween("text",u.getLinkTextTween)}).style("opacity",1);var m=s.exit().transition().duration(n.transitionDuration).remove();m.attr("transform","translate("+e.y+" "+e.x+")");var y={x:e.x,y:e.y,parent:{x:e.x,y:e.y}};m.selectAll("path.link.down").attr("d",function(){return u.getLinkD(y,"down")}),m.selectAll("path.link.right").attr("d",function(){return u.getLinkD(y,"right")}).attr("transform","translate(0 0)"),m.select("text").attr("x",0).attr("y",0).style("opacity",1e-6),a.forEach(function(e){e.x0=e.x,e.y0=e.y})}v.initialize=function(e){n=e},v.appendNode=function(e){n.nodeImageFile?v.appendNodeImage(e):n.nodeImageSelectionAppend&&"function"==typeof n.nodeImageSelectionAppend?n.nodeImageSelectionAppend(e):v.appendNodeSVG(e)},v.updateNode=function(e){if(n.nodeImageFile)v.updateNodeImage(e);else if(n.nodeImageSelectionUpdate&&"function"==typeof n.nodeImageSelectionUpdate)n.nodeImageSelectionUpdate(e);else{if(n.nodeImageSelectionAppend&&"function"==typeof n.nodeImageSelectionAppend)return;v.updateNodeSVG(e)}},v.appendNodeSVG=function(e){e.append("rect").attr("class","nodeImage").attr("x",-5).attr("y",-5).attr("width",10).attr("height",10);var t=e;t.append("line").attr("class",function(e){return e._children?"cross nodeImage":"cross invisible"}).attr("x1",0).attr("y1",-5).attr("x2",0).attr("y2",5),t.append("line").attr("class",function(e){return e._children?"cross nodeImage":"cross invisible"}).attr("x1",-5).attr("y1",0).attr("x2",5).attr("y2",0)},v.updateNodeSVG=function(e){e.selectAll("line.cross").attr("class",function(e){return e._children?"cross nodeImage":"cross invisible"})},v.appendNodeImage=function(e){if(n.nodeImageSetBackground){var t=I.select("div.chart").style("background-color");e.append("rect").attr("width",n.nodeImageWidth).attr("height",n.nodeImageHeight).attr("x",n.nodeImageX).attr("y",n.nodeImageY).style("stroke",t).style("fill",t)}e.append("image").attr("class","nodeImage").attr("xlink:href",n.nodeImageFileAppend).attr("width",n.nodeImageWidth).attr("height",n.nodeImageHeight).attr("x",n.nodeImageX).attr("y",n.nodeImageY)},v.updateNodeImage=function(e){e.select(".nodeImage").attr("xlink:href",n.nodeImageFileAppend)},e.chart=function(n){var i={};function a(t){t.each(function(e){(console.log(e),console.log("dataSpec: "),console.log(n),void 0!==e)?o(t,e):r(function(e){var t={};"object"===(void 0===e?"undefined":l(e))?(t.data=e.source,t.hierarchyLevels=e.hierarchyLevels,t.keyField=e.key?e.key:"key",t.delimiter=e.delimiter?e.delimiter:",",t.separator=e.separator?e.separator:"$"):console.log("dataspec is not an object!");t.isJSON="object"===l(t.data),t.isJSON||(t.fromFile=!(!t.data.endsWith(".json")&&!t.data.endsWith(".csv")));return t.flatData=!!Array.isArray(t.hierarchyLevels),i.keyField=t.keyField,i.nodeLabelField=t.flatData?i.nodeLabelFieldFlatData:t.keyField,t}(n),t,i,o)})}function o(e,t){s(e,t,i)}return i.debugOn=!1,i.margin={top:20,right:10,bottom:20,left:10},i.svgDimensions={height:800,width:1400},i.transitionDuration=750,i.defaultColor="grey",i.nodeImageFile=!1,i.nodeImageFileAppend=void 0,i.nodeImageSetBackground=!1,i.nodeImageWidth=10,i.nodeImageHeight=10,i.nodeImageX=i.nodeImageWidth/2,i.nodeImageY=i.nodeImageHeight/2,i.nodeImageSelectionAppend=void 0,i.nodeImageSelectionUpdate=void 0,i.nodeLabelField=void 0,i.nodeLabelFieldFlatData="__he_name",i.nodeLabelLength=50,i.nodeLabelPadding=10,i.linkHeight=20,i.linkLabelField="value",i.linkLabelOn=!1,i.linkLabelUnit="",i.linkLabelOnTop=!0,i.linkLabelAligned=!0,i.locale=void 0,i.linkLabelFormatSpecifier=",.0f",i.linkLabelFormat=I.format(i.linkLabelFormatSpecifier),i.linkWidthStatic=!0,i.linkWidthValue=30,i.linkWidthScale=I.scaleLinear(),i.linkWidthField="value",i.linkWidthRange=[15,100],i.linkStrengthStatic=!0,i.linkStrengthValue=1,i.linkStrengthScale=I.scaleLinear(),i.linkStrengthField="value",i.linkStrengthRange=[1,10],i.linkColorStatic=!0,i.linkColorScale=function(e){return e},i.linkColorField="color",i.linkColorInherit=!0,i.propagate=!1,i.propagateField="value",i.alignLeaves=!1,i.keyField="key",a.debugOn=function(e){return arguments.length?(i.debugOn=e,a):i.debugOn},a.defaultColor=function(e){return arguments.length?(i.defaultColor=e,"function"==typeof i.updateLinkColor&&i.updateLinkColor(),a):i.defaultColor},a.margin=function(e){return arguments.length?(i.margin=e,a):i.margin},a.svgDimensions=function(e){return arguments.length?(i.svgDimensions=e,a):i.svgDimensions},a.nodeLabelLength=function(e){return arguments.length?(i.nodeLabelLength=e,a):i.nodeLabelLength},a.nodeLabelPadding=function(e){return arguments.length?(i.nodeLabelPadding=e,a):i.nodeLabelPadding},a.transitionDuration=function(e){return arguments.length?(i.transitionDuration=e,a):i.transitionDuration},a.propagateValue=function(e){return arguments.length?(i.propagate=!0,i.propagateField=e,a):i.propagate+": "+i.propagateField},a.formatDefaultLocale=function(e){return arguments.length?("DE"===e&&(e={decimal:",",thousands:".",grouping:[3],currency:[""," â‚¬"]}),i.locale=I.formatDefaultLocale(e),a):i.locale},a.nodeImageFile=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return arguments.length?(i.nodeImageFile=!0,i.nodeImageFileAppend=e,i.nodeImageWidth=t.width||i.nodeImageWidth,i.nodeImageHeight=t.height||i.nodeImageHeight,i.nodeImageX=t.x||-1*i.nodeImageWidth/2,i.nodeImageY=t.y||-1*i.nodeImageHeight/2,i.nodeImageSetBackground=t.setBackground||i.nodeImageSetBackground,"function"==typeof i.updateDefault&&i.updateDefault(),a):i.nodeImageFileAppend},a.nodeImageSelection=function(e,t){return arguments.length?(i.nodeImageSelectionAppend=e,i.nodeImageSelectionUpdate=t,i.nodeImageFile=!1,"function"==typeof i.updateDefault&&i.updateDefault(),a):i.nodeImageSelectionAppend},a.linkHeight=function(e){return arguments.length?(i.linkHeight=e,"function"==typeof i.updateDefault&&i.updateDefault(),a):i.linkHeight},a.linkLabel=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:i.linkLabelField,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return arguments.length?("string"==typeof e?(i.linkLabelField=e,i.linkLabelOn=!0):"boolean"==typeof e&&(i.linkLabelOn=e),i.linkLabelOn&&(t.locale&&a.formatDefaultLocale(t.locale),i.linkLabelColor=t.color||i.linkLabelColor,i.linkLabelUnit=t.unit||i.linkLabelUnit,i.linkLabelFormat=t.format?I.format(t.format):i.linkLabelFormat,i.linkLabelOnTop=void 0!==t.onTop?t.onTop:i.linkLabelOnTop,i.linkLabelAligned=void 0!==t.align?t.align:i.linkLabelAligned),"function"==typeof i.updateDefault&&i.updateDefault(),a):i.linkLabelField},a.linkWidth=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:i.linkWidthField,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return arguments.length?("number"==typeof e?(i.linkWidthStatic=!0,i.linkWidthValue=e):"string"==typeof e&&(i.linkWidthStatic=!1,i.linkWidthField=e,i.linkWidthScale=t.scale||i.linkWidthScale,i.linkWidthRange=t.range||i.linkWidthRange),"function"==typeof i.updateLinkWidth&&i.updateLinkWidth(),a):i.linkWidthValue},a.linkStrength=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:i.linkStrengthField,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return arguments.length?("number"==typeof e?(i.linkStrengthStatic=!0,i.linkStrengthValue=e):"string"==typeof e&&(i.linkStrengthStatic=!1,i.linkStrengthField=e,i.linkStrengthScale=t.scale||i.linkStrengthScale,i.linkStrengthRange=t.range||i.linkStrengthRange),"function"==typeof i.updateLinkStrength&&i.updateLinkStrength(),a):i.linkStrengthValue},a.linkColor=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:i.linkColorField,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return arguments.length?(i.linkColorStatic=!1,i.linkColorField=e,i.linkColorScale=t.scale||i.linkColorScale,i.linkColorInherit=void 0!==t.inherit?t.inherit:i.linkColorInherit,"function"==typeof i.updateDefault&&i.updateDefault(),a):i.linkColorField},a.alignLeaves=function(e){return arguments.length?(i.alignLeaves=e,"function"==typeof i.updateAlignLeaves&&i.updateAlignLeaves(),a):i.alignLeaves},a},Object.defineProperty(e,"__esModule",{value:!0})});