!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("d3")):"function"==typeof define&&define.amd?define(["exports","d3"],t):t(e.d3=e.d3||{},e.d3)}(this,(function(e,t){"use strict";function n(e,n,o,r){const i=o.debugOn;if(e.fromFile)e.data.endsWith(".json")?t.json(e.data).then((function(e){i&&(console.log("Initial Data: "),console.log(e));const a=t.hierarchy(e);i&&(console.log("hierarchy: "),console.log(a)),r(n,a)})):e.data.endsWith(".csv")?t.dsv(e.delimiter,e.data,e.autoConvert?e.convertTypesFunction:void 0).then((function(t){i&&console.log(t),e.flatData&&(t=l(t,e.hierarchyLevels,e.keyField,e.delimiter,e.separator,o,e.autoConvert,e.convertTypesFunction));const d=a(t,e.keyField);i&&(console.log("hierarchy: "),console.log(d)),r(n,d)})):console.log("File must end with .json or .csv");else{let d;if(e.isJSON)d=t.hierarchy(e.data);else{const n=!e.flatData&&e.autoConvert;let r=function(e,n="aside#data",a=!0,o){const l=t.select(n).text().trim(),r=t.dsvFormat(e);return r.parse(l,a?o:void 0)}(e.delimiter,e.data,n,e.convertTypesFunction);e.flatData&&(r=l(r,e.hierarchyLevels,e.keyField,e.delimiter,e.separator,o,e.autoConvert,e.convertTypesFunction)),d=a(r,e.keyField),i&&(console.log("embedded data: "),console.log(d))}r(n,d)}}function a(e,n){return t.stratify().id((function(e){return e[n]})).parentId((function(e){return e.parent}))(e)}function o(e,t,n,a,o){let l=function(e,t,n,a){let o=1===n?t[0]:e[t[n-1]];for(let l=0;l<n;l++)0===l?o=t[0]:o+=a+e[t[l]];return o}(e,t,n,o);return l+a+(l+o+e[t[n]])}function l(e,n,a,l,r,i,d,c){const s=i.debugOn,g=i.nodeLabelFieldFlatData;let p,u,h,f,y,k,b=new Map,B=e=>((e,t)=>Object.keys(e).forEach((n=>e[n]=t)))(e,""),m=!0;for(var[L,x]of(e.forEach((e=>{m=!0,n.forEach(((t,a)=>{a>0&&m&&(f={},s&&e[t]&&(console.log("row[key]: "),console.log(e),console.log("key: "),console.log(t)),a===n.length-1?(h=o(e,n,a,l,r),b.get(h)||(Object.assign(f,e),f[g]=e[t],b.set(h,f))):(h=o(e,n,a,l,r),e[n[a+1]]?b.get(h)||(Object.assign(f,e),B(f),f[g]=e[t],b.set(h,f)):(Object.assign(f,e),f[g]=e[t],b.set(h,f),m=!1)))}))})),s&&console.log(b),k="parent"+l+a,Object.keys(e[0]).forEach((e=>{k+=l+e})),k+=l+g,p=k+"\n",k=l+n[0]+l,k+=l.repeat(Object.keys(e[0]).length),n[0]!==r&&(k+=n[0]),p+=k+"\n",b))k=L,y=Object.values(x),y.forEach((e=>{k+=l+e})),p+=k+"\n";s&&(console.log("converted linked Data:"),console.log(p));return u=t.dsvFormat(l).parse(p,d?c:void 0),u.map((e=>{e[g]=e[g]?e[g]:" "})),s&&(console.log("converted linked Data array:"),console.log(u)),u}let r,i,d,c={};function s(e){return!isNaN(e)&&!isNaN(parseFloat(e))}c.initialize=function(e){r=e,i=d,d=r.linkLabelOn?r.linkLabelField:void 0,r.debugOn&&(console.log("oldLabel:"),console.log(i),console.log("newLabel:"),console.log(d))},c.getLinkD=function(e,t,n=!1){const a=c.getLinkStrength(e.parent,r),o=c.getLinkStrength(e,r);let l;if("vertical"===t)if(n){const t=e.parent.children[e.parent.children.length-1].x;l="M 0 "+-1*Math.floor(a/2)+" V"+(t+o/2-e.parent.x)}else l="M 0 "+-1*Math.floor(a/2)+" V"+(e.x+o/2-e.parent.x);else if("horizontal"===t){l="M 0 0H"+(e.y>=e.parent.y?e.y-(e.parent.y+a/2):e.y-(e.parent.y-a/2))}return l},c.getDy=function(e){return r.linkLabelOnTop?"0.35em":Math.ceil(-.5*c.getLinkStrength(e)-3)},c.getInitialDy=function(){return t.select(this).attr("dy")?r.linkLabelOnTop?t.select(this).attr("dy").endsWith("em")?t.select(this).attr("dy"):"0.35em":t.select(this).attr("dy").endsWith("em")?0:t.select(this).attr("dy"):null},c.getLinkStrength=function(e){if(!e.data)return 0;return r.linkStrengthStatic?r.linkStrengthValue:r.linkStrengthScale(e.data[r.linkStrengthField])},c.getLinkStroke=function(e){return r.linkColorStatic?r.defaultColor:r.linkColorScale(e.data[r.linkColorField])},c.getLinkStrokeWidth=function(e){return c.getLinkStrength(e)+"px"},c.getLinkLabel=function(e,t=r.linkLabelField){return r.linkLabelOn&&void 0!==e.data[t]&&null!==e.data[t]?e.data[t]:""},c.getLinkLabelFormatted=function(e,t=r.linkLabelField){return r.linkLabelOn&&void 0!==e.data[t]?isNaN(e.data[t])||"string"==typeof e.data[t]?e.data[t]:r.linkLabelFormat(e.data[t])+r.linkLabelUnit:""},c.getLinkTextTween=function(e){const n=t.select(this);if(!r.linkLabelOn||null===e.data[d])return function(){n.text("")};const a=c.getLinkLabel(e,i),o=c.getLinkLabel(e,d);if(!s(a)||!s(o))return function(){n.text(o)};const l=t.interpolateNumber(a,o);return function(e){n.text(r.linkLabelFormat(l(e))+r.linkLabelUnit)}},c.getLinkRTranslate=function(e){return"translate("+(e.y>=e.parent.y?c.getLinkStrength(e.parent)/2:-1*c.getLinkStrength(e.parent)/2)+" "+(e.x-e.parent.x)+")"},c.getLinkLabelColor=function(e){return r.linkLabelColor?r.linkLabelColor(c.getLinkLabel(e,i)):t.select(this).style("fill")},c.getLinkTextPositionX=e=>{let t;switch(r.linkLabelAlignment){case"aligned":t=e.linkLabel.pos;break;case"start":t=e.y>=e.parent.y?10:e.y-e.parent.y+10;break;case"middle":t=(e.y-e.parent.y)/2;break;case"end":t=e.y>=e.parent.y?e.y-e.parent.y-10:-10}return t},c.getLinkLabelAnchor=function(e){return"aligned"===r.linkLabelAlignment?e.linkLabel.anchor:r.linkLabelAlignment},c.setupLabelDimensions=function(e){const n=function(e){const n=[],a=new Map,o=new Map;let l;return e.each((function(e){let n={};const r=t.select(this).node().getBBox().height,i=t.select(this).node().getBBox().width,d=t.select(this).text();l=e.y>=e.parent.y?a:o,i<=Math.abs(e.y-e.parent.y)-15&&(l.get(e.parent.id)?(n=l.get(e.parent.id),n.maxX<i&&(n.maxX=i,n.maxXText=d),(e.y>=e.parent.y&&n.posXCenter>(e.y-e.parent.y)/2||e.y<e.parent.y&&n.posXCenter<(e.y-e.parent.y)/2)&&(n.posXCenter=(e.y-e.parent.y)/2),n.maxY<r&&(n.maxY=r,n.maxYText=d),l.set(e.parent.id,n)):(n.maxX=i,n.minX=i,n.maxY=r,n.maxXText=d,n.maxYText=d,n.posXCenter=(e.y-e.parent.y)/2,l.set(e.parent.id,n)))})),n.push(a),n.push(o),n}(e);!function(e,n){let a;e.each((function(e){const o=t.select(this).node().getBBox().width;a=e.y>=e.parent.y?n[0]:n[1],e.linkLabel={},e.linkLabel.anchor="end",e.linkLabel.always=!0,o<=Math.abs(e.y-e.parent.y)-15?e.linkLabel.pos=a.get(e.parent.id).posXCenter+a.get(e.parent.id).maxX/2:(e.linkLabel.always=!1,e.y>=e.parent.y?e.linkLabel.pos=e.y-e.parent.y-10:(e.linkLabel.pos=e.y-e.parent.y+10,e.linkLabel.anchor="start",e.linkLabel.width=r.linkLabelAlways&&r.linkLabelOnTop&&"aligned"===r.linkLabelAlignment?o:0,e.linkLabel.overlap=e.linkLabel.width?e.linkLabel.pos+e.linkLabel.width:0))}))}(e,n),r.debugOn&&(console.log("dimensions:"),console.log(n))};let g,p,u,h={};h.initialize=function(e){g=e,p=u,u=g.nodeBarOn?g.nodeBarLabel:void 0},h.appendNode=function(e){g.nodeImageFile?h.appendNodeImage(e):g.nodeImageSelectionAppend&&"function"==typeof g.nodeImageSelectionAppend?g.nodeImageSelectionAppend(e):h.appendNodeSVG(e)},h.updateNode=function(e){if(g.nodeImageFile)h.updateNodeImage(e);else if(g.nodeImageSelectionUpdate&&"function"==typeof g.nodeImageSelectionUpdate)g.nodeImageSelectionUpdate(e);else{if(g.nodeImageSelectionAppend&&"function"==typeof g.nodeImageSelectionAppend)return;h.updateNodeSVG(e)}},h.appendNodeSVG=function(e){e.append("rect").attr("class","node-image").attr("x",-5).attr("y",-5).attr("width",10).attr("height",10);const t=e;t.append("line").attr("class",(e=>e._children?"cross node-image":"cross invisible")).attr("x1",0).attr("y1",-5).attr("x2",0).attr("y2",5),t.append("line").attr("class",(e=>e._children?"cross node-image":"cross invisible")).attr("x1",-5).attr("y1",0).attr("x2",5).attr("y2",0)},h.updateNodeSVG=function(e){e.selectAll("line.cross").attr("class",(e=>e._children?"cross node-image":"cross invisible"))},h.appendNodeImage=function(e){let n=e,a=e.filter((()=>!1));if("function"==typeof g.nodeImageFileAppend&&(n=e.filter((e=>g.nodeImageFileAppend(e))),a=e.filter((e=>!g.nodeImageFileAppend(e)))),g.nodeImageSetBackground){const e=t.select("div.chart").style("background-color");n.append("rect").attr("width",g.nodeImageWidth).attr("height",g.nodeImageHeight).attr("x",g.nodeImageX).attr("y",g.nodeImageY).style("stroke",e).style("fill",e)}n.append("image").attr("class","node-image").attr("xlink:href",g.nodeImageFileAppend).attr("width",g.nodeImageWidth).attr("height",g.nodeImageHeight).attr("preserveAspectRatio",g.nodeImagePreserveAspectRatio).attr("x",g.nodeImageX).attr("y",g.nodeImageY),g.nodeImageDefault&&a.size()>0&&h.appendNodeSVG(a),g.debugOn&&(console.log("imageSelection.size: "+n.size()),console.log("noImageSelection.size: "+a.size()))},h.updateNodeImage=function(e){e.select(".node-image").attr("xlink:href",g.nodeImageFileAppend),h.updateNodeSVG(e)},h.computeNodeExtend=function(e){let n,a=[],o=0;const l=c,r=e.filter((e=>void 0!==e.data[u]));r.each((function(e){e.nodeBar={},e.nodeBar.connectorStart=f(t.select(this),e,l),e.nodeBar.labelWidth=b(e.data[u]),a.push(k(e,e.y+e.nodeBar.connectorStart)),o=e.linkLabel&&e.linkLabel.width>o?e.linkLabel.width:o,g.debugOn&&console.log("connctorStart: "+e.nodeBar.connectorStart)})),a.anchor=Math.max(...a),n=a.anchor+g.nodeBarTranslateX+o,g.debugOn&&(console.log("alignmentAnchorArray: "+a),console.log("options.nodeBarRange[1]: "+g.nodeBarRange[1]),console.log("anchorXPos: "+n)),r.each((function(e){e.nodeBar.anchor=n-e.y,e.nodeBar.negStart=e.nodeBar.anchor-g.nodeBarRange[1]/2,e.data[g.nodeBarField]<0?g.nodeBarLabelInside?(e.nodeBar.textX=e.nodeBar.anchor-5,e.nodeBar.connectorLength=y(e)?e.nodeBar.textX-e.nodeBar.labelWidth-5-e.nodeBar.connectorStart:e.nodeBar.negStart+g.nodeBarScale(e.data[g.nodeBarField])-5-e.nodeBar.connectorStart):(e.nodeBar.textX=e.nodeBar.negStart+g.nodeBarScale(e.data[g.nodeBarField])-5,e.nodeBar.connectorLength=e.nodeBar.textX-e.nodeBar.labelWidth-5-e.nodeBar.connectorStart):g.nodeBarLabelInside?(e.nodeBar.textX=e.nodeBar.anchor+5,e.nodeBar.connectorLength=e.nodeBar.anchor-5-e.nodeBar.connectorStart):(e.nodeBar.textX=g.nodeBarNeg?e.nodeBar.negStart+g.nodeBarScale(e.data[g.nodeBarField])+5:e.nodeBar.anchor+g.nodeBarScale(e.data[g.nodeBarField])+5,e.nodeBar.connectorLength=e.nodeBar.anchor-5-e.nodeBar.connectorStart),g.debugOn&&(console.log("connector: "+e.nodeBar.connectorLength),console.log("nodesAPI.getWidthNodeBarRect(d): "+h.getWidthNodeBarRect(e)))}))};const f=function(e,t,n){const a=e.select(".node-label").node().getBBox(),o=e.select(".node-image").node().getBBox();let l=0;return l=!t.parent||t.y>=t.parent.y?0!==a.width?g.nodeLabelPadding+a.width:o.width/2:t.linkLabel&&t.linkLabel.overlap?o.width/2+5+t.linkLabel.width:t.parent.y-t.y+n.getLinkStrength(t.parent,g)/2,l+5},y=e=>e.nodeBar.labelWidth+5>h.getWidthNodeBarRect(e),k=function(e,t){return!g.nodeBarLabelInside&&e.data[g.nodeBarField]<0?t+=5+e.nodeBar.labelWidth:g.nodeBarLabelInside&&e.data[g.nodeBarField]<0&&y(e)&&(t+=e.nodeBar.labelWidth+5-h.getWidthNodeBarRect(e)),t+=e.data[g.nodeBarField]<0?5+h.getWidthNodeBarRect(e):5},b=function(e){const n=t.select("g.node").append("text").style("visibility","hidden").attr("class","bar-label temp").text(isNaN(e)?e:g.nodeBarFormat(e)+g.nodeBarUnit),a=n.node().getBBox().width;return n.remove(),a};h.getNodeBarLabelTween=function(e){const n=t.select(this);if(!g.nodeBarOn)return function(){n.text("")};const a=p?e.data[p]:e.data[u],o=e.data[u];if(n.style("text-anchor",(()=>a<0?"end":"start")),isNaN(a)||isNaN(o))return function(){n.text(o)};if(h.sameBarLabel())return function(){n.text(g.nodeBarFormat(o)+g.nodeBarUnit)};const l=t.interpolateNumber(a,o),r=t.selectAll(".node-bar.box").filter((t=>t.id===e.id));let i=!0;return a||r.attr("class",(()=>o>=0?"node-bar box node-bar-positive":"node-bar box node-bar-negative")),function(e){const t=l(e);i&&a*t<=0&&(r.attr("class",(()=>t>=0?"node-bar box node-bar-positive":"node-bar box node-bar-negative")),n.style("text-anchor",(()=>t<0?"end":"start")),i=!1),n.text(g.nodeBarFormat(t)+g.nodeBarUnit)}},h.sameBarLabel=()=>(console.log("sameBarlabel: "+(p===u)),p===u),h.getNodeBarD=e=>`M ${e.nodeBar.connectorLength+e.nodeBar.connectorStart} 0 h ${-e.nodeBar.connectorLength}`,h.getXNodeBarRect=e=>g.nodeBarNeg?e.nodeBar.negStart+g.nodeBarScale(Math.min(0,e.data[g.nodeBarField])):e.nodeBar.anchor,h.getWidthNodeBarRect=e=>Math.abs(g.nodeBarScale(e.data[g.nodeBarField])-g.nodeBarScale(0)),h.getXNodeBarText=e=>e.nodeBar.textX,h.getNodeBarTextFill=function(e){return g.nodeBarTextFill?g.nodeBarTextFill(e):t.select(this).style("fill")},h.getNodeBarRectFill=function(e){return g.nodeBarRectFill?g.nodeBarRectFill(e):null},h.getNodeBarRectStroke=function(e){return g.nodeBarRectStroke?g.nodeBarRectStroke(e):t.select(this).style("stroke")},h.getNodeBarTextAnchor=function(e){return e.data[g.nodeBarField]<0?"end":"start"},h.setNodeBarDefaultClass=function(e){return p&&p!==u?t.select(this).attr("class"):e.data[g.nodeBarField]>=0?"node-bar box node-bar-positive":"node-bar box node-bar-negative"};let B=0;function m(e,t,n){let a={};a.width=n.svgDimensions.width-n.margin.right-n.margin.left,a.height=n.svgDimensions.height-n.margin.top-n.margin.bottom,a.i=0,a.tree=void 0,a.root=void 0,a.svg=void 0,a.counter=0,a.labelDimensions=[],a.svg=e.append("svg").attr("width",a.width+n.margin.right+n.margin.left).attr("height",a.height+n.margin.top+n.margin.bottom).append("g").attr("transform","translate("+n.margin.left+","+n.margin.top+")"),L(n,a,t),x(n,a),function(e,t,n){e.updateLinkWidth=function(){e.linkWidthStatic?t.tree.nodeSize([0,e.linkWidthValue]):x(e,t),I(t.root,e,t)},e.updateScales=function(){x(e,t),I(t.root,e,t)},e.updateAlignLeaves=function(){L(e,t,n),I(t.root,e,t)},e.updateCollapse=function(){S(e,t,!1)},e.updateExpand=function(){!function(e,t){const n=[];t.root.eachBefore((e=>n.push(e)));for(let a of n)v(a,e)&&(A(a,e),x(e,t),I(a,e,t))}(e,t)},e.updateDefault=function(){I(t.root,e,t)}}(n,a,t),n.nodeCollapse&&S(n,a,!0),I(a.root,n,a)}function L(e,n,a){n.tree=e.alignLeaves?t.cluster():t.tree(),n.tree.size([n.width,n.height]).nodeSize([0,e.linkWidthValue]),n.root=n.tree(a),e.propagate&&n.root.sum((t=>t[e.propagateField])),n.root.each((t=>{t.name=t.id,t.id=n.i,n.i++,e.propagate&&(t.data[e.propagateField]=t.value)})),n.root.x0=n.root.x,n.root.y0=n.root.y,e.propagate&&(e.propagate=!1),e.debugOn&&(console.log("Data:"),console.log(a),console.log("Tree:"),console.log(n.root))}function x(e,n){let a=n.root.descendants();if(e.linkStrengthStatic||e.linkStrengthScale.domain(t.extent(a,(t=>+t.data[e.linkStrengthField]))).range(e.linkStrengthRange),!e.linkWidthStatic){const n=t.extent(a.slice(1),(t=>+t.data[e.linkWidthField]));e.linkWidthScale.domain(n[0]===n[1]?[n[0],n[0]+1]:n).range(e.linkWidthRange)}if(e.nodeBarOn&&e.nodeBarUpdateScale){let n;if(e.nodeBarDomain)n=e.nodeBarDomain;else{const o=t.extent(a,(t=>+t.data[e.nodeBarField])),l=Math.max(Math.abs(o[0]),Math.abs(o[1]));e.nodeBarNeg=o[0]<0,o[0]>=0&&o[1]>=0?(n=[0,l],e.nodeBarRangeAdjusted&&(e.nodeBarRange=[e.nodeBarRange[0],e.nodeBarRange[1]/2],e.nodeBarRangeAdjusted=!1)):o[0]<0&&o[1]<0?(n=[o[0],0],e.nodeBarRangeAdjusted&&(e.nodeBarRange=[e.nodeBarRange[0],e.nodeBarRange[1]/2],e.nodeBarRangeAdjusted=!1)):(n=[-l,l],e.nodeBarRange=[e.nodeBarRange[0],2*e.nodeBarRangeUpperBound],e.nodeBarRangeAdjusted=!0)}e.nodeBarScale.domain(n).range(e.nodeBarRange).clamp(!0)}}function S(e,t,n){const a=[];t.root.eachAfter((e=>a.push(e)));let o=!1;for(let l of a)D(l,e)&&(o=!l.children,e.nodeCollapsePropagate?l.eachAfter((e=>F(e))):F(l),n||o||(x(e,t),I(l,e,t)));n&&(x(e,t),I(t.root,e,t))}function F(e){e.children&&(e._children=e.children,e.children=null)}function v(e,t){const n="key"===t.nodeExpandProperty?e.data[t.keyField]:e[t.nodeExpandProperty];return t.nodeExpandArray.includes(n)}function D(e,t){const n="key"===t.nodeCollapseProperty?e.data[t.keyField]:e[t.nodeCollapseProperty];return t.nodeCollapseArray.includes(n)}function A(e,t){e.children||(e.children=e._children,e._children=null),e.children&&e.children.forEach((e=>{(t.nodeExpandPropagate||v(e,t))&&A(e,t)}))}function I(e,n,a){n.nodeResort&&a.root.sort(n.nodeResortFunction),console.log("update");let o=a.tree(a.root),l=[];o.eachBefore((function(e){l.push(e)})),a.height=Math.max(500,l.length*n.linkHeight+n.margin.top+n.margin.bottom);let r=l.slice(1);l.forEach(((e,t)=>{e.x=t*n.linkHeight,n.linkWidthStatic||0!==t&&(e.y=e.parent.y+n.linkWidthScale(+e.data[n.linkWidthField]))})),a.svg.transition().duration(n.transitionDuration).attr("height",a.height);const i=c;i.initialize(n);const d=a.svg.selectAll("g.link").data(r,(function(e){return e.id+"->"+e.parent.id})),s=d.enter().insert("g","g.node").attr("class","link").attr("transform","translate("+e.y0+" "+e.x0+")"),g={x:e.x0,y:e.y0,parent:{x:e.x0,y:e.y0}};s.filter((function(e){return e.id===e.parent.children[e.parent.children.length-1].id})).lower().append("path").attr("class","link vertical").attr("d",(()=>i.getLinkD(g,"vertical"))),s.append("path").attr("class","link horizontal").attr("d",(()=>i.getLinkD(g,"horizontal"))),s.append("text").style("opacity",1e-6);const p=d.merge(s);p.select("text").attr("class",n.linkLabelOnTop?"label ontop":"label above").attr("dy",i.getInitialDy).attr("id",(e=>"link-label-"+e.id)).text((e=>i.getLinkLabelFormatted(e))).style("fill",i.getLinkLabelColor);const u=p.transition().duration(n.transitionDuration);i.setupLabelDimensions(t.selectAll(".link text.label")),u.attr("transform",(e=>"translate("+e.parent.y+" "+e.parent.x+")")),u.select("path.link.vertical").attr("d",(e=>i.getLinkD(e,"vertical",!0))).style("stroke",(e=>n.linkColorInherit?i.getLinkStroke(e.parent):"")).style("stroke-width",(e=>i.getLinkStrokeWidth(e.parent))),u.select("path.link.horizontal").attr("d",(e=>i.getLinkD(e,"horizontal"))).attr("transform",i.getLinkRTranslate).style("stroke",i.getLinkStroke).style("stroke-width",i.getLinkStrokeWidth),u.select("text").attr("dy",i.getDy).attr("text-anchor",i.getLinkLabelAnchor).attr("x",i.getLinkTextPositionX).attr("y",(e=>e.x-e.parent.x)).call((e=>e.tween("text",i.getLinkTextTween))).style("opacity",(e=>n.linkLabelAlways||e.linkLabel.always?1:0));const f=d.exit().transition().duration(n.transitionDuration).remove();f.attr("transform","translate("+e.y+" "+e.x+")");const y={x:e.x,y:e.y,parent:{x:e.x,y:e.y}};f.selectAll("path.link.vertical").attr("d",(()=>i.getLinkD(y,"vertical"))),f.selectAll("path.link.horizontal").attr("d",(()=>i.getLinkD(y,"horizontal"))).attr("transform","translate(0 0)"),f.select("text").attr("x",0).attr("y",0).style("opacity",1e-6);const k=h;k.initialize(n);const b=a.svg.selectAll("g.node").data(l,(function(e){return e.id||(e.id=++a.i)})),m=b.enter().append("g").attr("class","node").style("visibility","hidden").on("click",((e,t)=>function(e,t,n){e.children?(e._children=e.children,e.children=null):(e.children=e._children,e._children=null),t.transitionDuration=t.transitionDurationClick,x(t,n),I(e,t,n),t.transitionDuration=t.transitionDurationDefault}(t,n,a)));m.call(k.appendNode),m.append("text").attr("class","node-label").attr("dy",".35em").attr("x",(e=>!e.parent||e.y>=e.parent.y?n.nodeLabelPadding:-n.nodeLabelPadding)).attr("text-anchor",(e=>!e.parent||e.y>=e.parent.y?"start":"end")).text((function(e){return e.data[n.nodeLabelField].length>n.nodeLabelLength?e.data[n.nodeLabelField].substring(0,n.nodeLabelLength)+"...":e.data[n.nodeLabelField]})),n.nodeTitleOn&&m.append("svg:title").text((function(e){return""!==n.nodeTitleField&&e.data[n.nodeTitleField]?e.data[n.nodeTitleField]:e.data[n.nodeLabelField]})),m.style("visibility","hidden");const L=m.append("g").attr("class","node-bar").style("display",(e=>n.nodeBarOn&&null!==e.data[n.nodeBarField]?"inline":"none"));L.append("path").attr("class","node-bar connector").attr("d","M 0 0 h 0"),L.append("rect").attr("class",k.setNodeBarDefaultClass).attr("y",-8).attr("height",16),L.append("text").attr("class","node-bar bar-label").attr("dy",".35em");let S=b.merge(m);S.selectAll("g.node-bar").style("display",(e=>n.nodeBarOn&&null!==e.data[n.nodeBarField]?"inline":"none")),n.nodeBarOn&&k.computeNodeExtend(S),m.attr("transform","translate("+e.y0+","+e.x0+") scale(0.001, 0.001)").style("visibility","visible");let F="trans"+B++,v=S.transition(F).duration(n.transitionDuration);if(n.debugOn&&(console.log("transition: "+F),console.log("nodeUpdate.size: "+v.size())),v.attr("transform",(e=>"translate("+e.y+","+e.x+") scale(1,1)")),v.call(k.updateNode),v.selectAll(".node-label").attr("x",(e=>!e.parent||e.y>=e.parent.y?n.nodeLabelPadding:-n.nodeLabelPadding)).attr("text-anchor",(e=>!e.parent||e.y>=e.parent.y?"start":"end")),v.selectAll("g.node-bar").attr("display",n.nodeBarOn?"inline":"none"),n.nodeBarOn){const e=v.filter((e=>null!==e.data[n.nodeBarField]));e.selectAll(".node-bar.box").attr("class",k.setNodeBarDefaultClass).style("fill",k.getNodeBarRectFill).style("stroke",k.getNodeBarRectStroke).attr("x",k.getXNodeBarRect).attr("width",k.getWidthNodeBarRect),e.selectAll(".node-bar.bar-label").style("fill",k.getNodeBarTextFill).call((e=>e.tween("nodeBarLabel"+B,k.getNodeBarLabelTween))).attr("x",k.getXNodeBarText),e.selectAll(".node-bar.connector").attr("d",k.getNodeBarD)}var D=b.exit().transition().duration(n.transitionDuration);D.attr("transform",(function(){return"translate("+e.y+","+e.x+") scale(0.001, 0.001)"})).remove(),D.select(".node-label").style("fill-opacity",1e-6),l.forEach((function(e){e.x0=e.x,e.y0=e.y}))}e.indentedTree=function(e){let a={};function o(o){o.each((function(r){if(console.log(r),console.log("dataSpec: "),console.log(e),void 0!==r)l(o,r);else{n(function(e){let n={};if("object"==typeof e){if(n.data=e.source,n.hierarchyLevels=e.hierarchyLevels,n.flatData=!!Array.isArray(n.hierarchyLevels),n.keyField=e.key?e.key:"key",n.delimiter=e.delimiter?e.delimiter:",",n.separator=e.separator?e.separator:"$",n.autoConvert=!0,n.convertTypesFunction=t.autoType,"none"===e.convertTypes)n.autoConvert=!1;else if("function"==typeof e.convertTypes)if(n.flatData){const t=function(t){let n=e.convertTypes(t);return n.key=t.key,n.parent=t.parent,n.__he_name=t.__he_name,n};n.convertTypesFunction=t}else n.convertTypesFunction=e.convertTypes}else console.log("dataspec is not an object!");n.isJSON="object"==typeof n.data,n.isJSON?n.fromFile=!1:n.fromFile=!(!n.data.endsWith(".json")&&!n.data.endsWith(".csv"));return a.keyField=n.keyField,a.nodeLabelField=n.flatData?a.nodeLabelFieldFlatData:n.keyField,n}(e),o,a,l)}}))}function l(e,t){m(e,t,a)}return a.debugOn=!1,a.margin={top:20,right:10,bottom:20,left:10},a.svgDimensions={height:800,width:1400},a.transitionDurationDefault=750,a.transitionDurationClick=750,a.transitionDuration=a.transitionDurationDefault,a.locale=void 0,a.defaultColor="grey",a.nodeBarOn=!1,a.nodeBarField="value",a.nodeBarLabel=a.nodeBarField,a.nodeBarLabelInside=!1,a.nodeBarUnit="",a.nodeBarFormatSpecifier=",.0f",a.nodeBarFormat=t.format(a.nodeBarFormatSpecifier),a.nodeBarScale=t.scaleLinear(),a.nodeBarRange=[0,200],a.nodeBarRangeUpperBound=a.nodeBarRange[1],a.nodeBarRangeAdjusted=!1,a.nodeBarUpdateScale=!0,a.nodeBarTranslateX=50,a.nodeBarState={},a.nodeImageFile=!1,a.nodeImageFileAppend=void 0,a.nodeImageSetBackground=!1,a.nodeImageDefault=!0,a.nodeImageWidth=10,a.nodeImageHeight=10,a.nodeImageX=a.nodeImageWidth/2,a.nodeImageY=a.nodeImageHeight/2,a.nodeImagePreserveAspectRatio=void 0,a.nodeImageSelectionAppend=void 0,a.nodeImageSelectionUpdate=void 0,a.nodeLabelField=void 0,a.nodeLabelFieldFlatData="__he_name",a.nodeLabelLength=50,a.nodeLabelPadding=10,a.nodeResort=!1,a.nodeResortAscending=!1,a.nodeResortField="value",a.nodeResortByHeight=!1,a.nodeResortFunction=function(e,t){let n=a.nodeResortByHeight?t.height-e.height:0;return 0===n&&(n="string"==typeof e.data[a.nodeResortField]?t.data[a.nodeResortField].localeCompare(e.data[a.nodeResortField]):t.data[a.nodeResortField]-e.data[a.nodeResortField]),a.nodeResortAscending&&(n*=-1),n},a.nodeCollapse=!1,a.nodeCollapseArray=[],a.nodeCollapseProperty="key",a.nodeCollapsePropagate=!0,a.nodeExpand=!1,a.nodeExpandArray=[],a.nodeExpandProperty="key",a.nodeExpandPropagate=!0,a.nodeTitleOn=!0,a.nodeTitleField="",a.linkHeight=20,a.linkLabelField="value",a.linkLabelOn=!1,a.linkLabelUnit="",a.linkLabelOnTop=!0,a.linkLabelAlignment="aligned",a.linkLabelAlways=!1,a.linkLabelFormatSpecifier=",.0f",a.linkLabelFormat=t.format(a.linkLabelFormatSpecifier),a.linkWidthStatic=!0,a.linkWidthValue=30,a.linkWidthScale=t.scaleLinear().clamp(!0),a.linkWidthField="value",a.linkWidthRange=[15,100],a.linkStrengthStatic=!0,a.linkStrengthValue=1,a.linkStrengthScale=t.scaleLinear(),a.linkStrengthField="value",a.linkStrengthRange=[1,10],a.linkColorStatic=!0,a.linkColorScale=e=>e,a.linkColorField="color",a.linkColorInherit=!0,a.propagate=!1,a.propagateField="value",a.alignLeaves=!1,a.keyField="key",o.debugOn=function(e){return arguments.length?(a.debugOn=e,o):a.debugOn},o.defaultColor=function(e){return arguments.length?(a.defaultColor=e,"function"==typeof a.updateLinkColor&&a.updateLinkColor(),o):a.defaultColor},o.margin=function(e){return arguments.length?(a.margin=e,o):a.margin},o.svgDimensions=function(e){return arguments.length?(a.svgDimensions=e,o):a.svgDimensions},o.nodeLabelLength=function(e){return arguments.length?(a.nodeLabelLength=e,o):a.nodeLabelLength},o.nodeLabelPadding=function(e){return arguments.length?(a.nodeLabelPadding=e,o):a.nodeLabelPadding},o.transitionDuration=function(e){return arguments.length?(a.transitionDurationDefault=e,a.transitionDuration=e,o):a.transitionDuration},o.propagateValue=function(e){return arguments.length?(a.propagate=!0,a.propagateField=e,o):a.propagate+": "+a.propagateField},o.formatDefaultLocale=function(e){return arguments.length?("DE"===e&&(e={decimal:",",thousands:".",grouping:[3],currency:[""," €"]}),a.locale=t.formatDefaultLocale(e),o):a.locale},o.nodeBar=function(e=a.nodeBarField,n={}){return arguments.length?("string"==typeof e?(a.nodeBarField=e,a.nodeBarOn=!0):"boolean"==typeof e&&(a.nodeBarOn=e),a.nodeBarOn&&(n.locale&&o.formatDefaultLocale(n.locale),a.nodeBarLabel=n.label||a.nodeBarField,a.nodeBarState.oldField=a.nodeBarState.newField,a.nodeBarState.newField=a.nodeBarLabel,a.nodeBarLabelInside=void 0!==n.labelInside?n.labelInside:a.nodeBarLabelInside,a.nodeBarTextFill=n.textFill||a.nodeBarTextFill,a.nodeBarRectFill=n.rectFill||a.nodeBarRectFill,a.nodeBarRectStroke=n.rectStroke||a.nodeBarRectStroke,a.nodeBarUnit=n.unit||a.nodeBarUnit,a.nodeBarFormat=n.format?t.format(n.format):a.nodeBarFormat,a.nodeBarTranslateX=n.translateX||a.nodeBarTranslateX,a.nodeBarScale=n.scale||a.nodeBarScale,n.range&&(a.nodeBarRange=n.range,a.nodeBarRangeAdjusted=!1,a.nodeBarRangeUpperBound=a.nodeBarRange[1]),a.nodeBarDomain=n.domain||a.nodeBarDomain,void 0!==n.updateScale&&(a.nodeBarUpdateScale=n.updateScale)),"function"==typeof a.updateScales&&a.updateScales(),o):a.nodeBarField},o.nodeImageFile=function(e,t={}){return arguments.length?(a.nodeImageFile=!0,a.nodeImageFileAppend=e,a.nodeImageWidth=t.width||a.nodeImageWidth,a.nodeImageHeight=t.height||a.nodeImageHeight,a.nodeImageX=t.x||-1*a.nodeImageWidth/2,a.nodeImageY=t.y||-1*a.nodeImageHeight/2,a.nodeImagePreserveAspectRatio=t.preserveAspectRatio||a.nodeImagePreserveAspectRatio,a.nodeImageSetBackground=void 0!==t.setBackground?t.setBackground:a.nodeImageSetBackground,a.nodeImageDefault=void 0!==t.default?t.default:a.nodeImageDefault,"function"==typeof a.updateDefault&&a.updateDefault(),o):a.nodeImageFileAppend},o.nodeImageSelection=function(e,t){return arguments.length?(a.nodeImageSelectionAppend=!1===e?function(){}:e,a.nodeImageSelectionUpdate=t,a.nodeImageFile=!1,"function"==typeof a.updateDefault&&a.updateDefault(),o):a.nodeImageSelectionAppend},o.nodeSort=function(e=a.nodeSortField,t={}){return arguments.length?("string"==typeof e&&(a.nodeResort=!0,a.nodeResortAscending=void 0!==t.ascending?t.ascending:a.nodeResortAscending,a.nodeResortByHeight=void 0!==t.sortByHeight?t.sortByHeight:a.nodeResortByHeight,a.nodeResortField=e),"function"==typeof a.updateDefault&&a.updateDefault(),o):a.nodeSortField},o.nodeCollapse=function(e=a.nodeCollapseArray,t={}){return arguments.length?(Array.isArray(e)||(e=[e]),a.nodeCollapse=!0,a.nodeCollapseArray=e,a.nodeCollapseProperty=t.property||a.nodeCollapseProperty,a.nodeCollapsePropagate=void 0!==t.propagate?t.propagate:a.nodeCollapsePropagate,"function"==typeof a.updateCollapse&&a.updateCollapse(),o):a.nodeCollapseArray},o.nodeExpand=function(e=a.nodeExpandArray,t={}){return arguments.length?(Array.isArray(e)||(e=[e]),a.nodeExpand=!0,a.nodeExpandArray=e,a.nodeExpandProperty=t.property||a.nodeExpandProperty,a.nodeExpandPropagate=void 0!==t.propagate?t.propagate:a.nodeExpandPropagate,"function"==typeof a.updateExpand&&a.updateExpand(),o):a.nodeExpandArray},o.nodeTitle=function(e=a.nodeTitleOn){return arguments.length?(a.nodeTitleField=!1,"string"==typeof e?(a.nodeTitleField=e,a.nodeTitleOn=!0):"boolean"==typeof e&&(a.nodeTitleOn=e),"function"==typeof a.updateDefault&&a.updateDefault(),o):a.nodeTitleOn},o.linkHeight=function(e){return arguments.length?(a.linkHeight=e,"function"==typeof a.updateDefault&&a.updateDefault(),o):a.linkHeight},o.linkLabel=function(e=a.linkLabelField,n={}){return arguments.length?("string"==typeof e?(a.linkLabelField=e,a.linkLabelOn=!0):"boolean"==typeof e&&(a.linkLabelOn=e),a.linkLabelOn&&(n.locale&&o.formatDefaultLocale(n.locale),a.linkLabelColor=n.color||a.linkLabelColor,a.linkLabelUnit=n.unit||a.linkLabelUnit,a.linkLabelFormat=n.format?t.format(n.format):a.linkLabelFormat,a.linkLabelOnTop=void 0!==n.onTop?n.onTop:a.linkLabelOnTop,a.linkLabelAlways=void 0!==n.always?n.always:a.linkLabelAlways,a.linkLabelAlignment=n.align||a.linkLabelAlignment),"function"==typeof a.updateDefault&&a.updateDefault(),o):a.linkLabelField},o.linkWidth=function(e=a.linkWidthField,t={}){return arguments.length?("number"==typeof e?(a.linkWidthStatic=!0,a.linkWidthValue=e):"string"==typeof e&&(a.linkWidthStatic=!1,a.linkWidthField=e,a.linkWidthScale=t.scale||a.linkWidthScale,a.linkWidthRange=t.range||a.linkWidthRange),"function"==typeof a.updateLinkWidth&&a.updateLinkWidth(),o):a.linkWidthStatic?a.linkWidthValue:a.linkWidthField},o.linkStrength=function(e=a.linkStrengthField,t={}){return arguments.length?("number"==typeof e?(a.linkStrengthStatic=!0,a.linkStrengthValue=e):"string"==typeof e&&(a.linkStrengthStatic=!1,a.linkStrengthField=e,a.linkStrengthScale=t.scale||a.linkStrengthScale,a.linkStrengthRange=t.range||a.linkStrengthRange),"function"==typeof a.updateScales&&a.updateScales(),o):a.linkStrengthValue},o.linkColor=function(e=a.linkColorField,t={}){return arguments.length?(a.linkColorStatic=!1,a.linkColorField=e,a.linkColorScale=t.scale||a.linkColorScale,a.linkColorInherit=void 0!==t.inherit?t.inherit:a.linkColorInherit,"function"==typeof a.updateDefault&&a.updateDefault(),o):a.linkColorField},o.alignLeaves=function(e){return arguments.length?(a.alignLeaves=e,"function"==typeof a.updateAlignLeaves&&a.updateAlignLeaves(),o):a.alignLeaves},o},Object.defineProperty(e,"__esModule",{value:!0})}));