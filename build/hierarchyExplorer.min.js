!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("d3")):"function"==typeof define&&define.amd?define(["exports","d3"],t):t(e.hierarchyExplorer={},e.d3)}(this,function(e,R){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},I=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],a=!0,o=!1,r=void 0;try{for(var i,l=e[Symbol.iterator]();!(a=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){o=!0,r=e}finally{try{!a&&l.return&&l.return()}finally{if(o)throw r}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};function l(n,a,o,r){var i=o.debugOn;if(n.fromFile)n.data.endsWith(".json")?R.json(n.data).then(function(e){i&&(console.log("Initial Data: "),console.log(e));var t=R.hierarchy(e);i&&(console.log("hierarchy: "),console.log(t)),r(a,t)}):n.data.endsWith(".csv")?R.dsv(n.delimiter,n.data,n.autoConvert?n.convertTypesFunction:void 0).then(function(e){i&&console.log(e),n.flatData&&(e=c(e,n.hierarchyLevels,n.keyField,n.delimiter,n.separator,o,n.autoConvert,n.convertTypesFunction));var t=d(e,n.keyField);i&&(console.log("hierarchy: "),console.log(t)),r(a,t)}):console.log("File must end with .json or .csv");else{var e=void 0;if(n.isJSON)e=R.hierarchy(n.data);else{var t=!n.flatData&&n.autoConvert,l=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"aside#data",n=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],a=arguments[3],o=R.select(t).text().trim();return R.dsvFormat(e).parse(o,n?a:void 0)}(n.delimiter,n.data,t,n.convertTypesFunction);n.flatData&&(l=c(l,n.hierarchyLevels,n.keyField,n.delimiter,n.separator,o,n.autoConvert,n.convertTypesFunction)),e=d(l,n.keyField),i&&(console.log("embedded data: "),console.log(e))}r(a,e)}}function d(e,t){return R.stratify().id(function(e){return e[t]}).parentId(function(e){return e.parent})(e)}function A(e,t,n,a,o){var r=function(e,t,n,a){for(var o=1===n?t[0]:e[t[n-1]],r=0;r<n;r++)0===r?o=t[0]:o+=a+e[t[r]];return o}(e,t,n,o);return r+a+(r+o+e[t[n]])}function c(e,a,t,o,r,n,i,l){function d(e){return function(t,n){return Object.keys(t).forEach(function(e){return t[e]=n})}(e,"")}var c=n.debugOn,s=n.nodeLabelFieldFlatData,u=void 0,g=void 0,h=new Map,f=void 0,p=void 0,y=void 0,k=!0;e.forEach(function(n){k=!0,a.forEach(function(e,t){0<t&&k&&(p={},c&&n[e]&&(console.log("row[key]: "),console.log(n),console.log("key: "),console.log(e)),t===a.length-1?(f=A(n,a,t,o,r),h.get(f)||(Object.assign(p,n),p[s]=n[e],h.set(f,p))):(f=A(n,a,t,o,r),n[a[t+1]]?h.get(f)||(Object.assign(p,n),d(p),p[s]=n[e],h.set(f,p)):(Object.assign(p,n),p[s]=n[e],h.set(f,p),k=!1)))})}),c&&console.log(h),y="parent"+o+t,Object.keys(e[0]).forEach(function(e){y+=o+e}),u=(y+=o+s)+"\n",y=o+a[0]+o,y+=o.repeat(Object.keys(e[0]).length),a[0]!==r&&(y+=a[0]),u+=y+"\n";var b=!0,B=!1,v=void 0;try{for(var m,L=h[Symbol.iterator]();!(b=(m=L.next()).done);b=!0){var S=m.value,x=I(S,2),F=x[0],D=x[1];y=F,Object.values(D).forEach(function(e){y+=o+e}),u+=y+"\n"}}catch(e){B=!0,v=e}finally{try{!b&&L.return&&L.return()}finally{if(B)throw v}}return c&&(console.log("converted linked Data:"),console.log(u)),(g=R.dsvFormat(o).parse(u,i?l:void 0)).map(function(e){e[s]=e[s]?e[s]:" "}),c&&(console.log("converted linked Data array:"),console.log(g)),g}var L={},s=void 0,r=void 0,u=void 0;function g(e){return!isNaN(e)}L.initialize=function(e){r=u,u=(s=e).linkLabelOn?s.linkLabelField:void 0,s.debugOn&&(console.log("oldLabel:"),console.log(r),console.log("newLabel:"),console.log(u))},L.getLinkD=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],a=L.getLinkStrength(e.parent,s),o=L.getLinkStrength(e,s),r=void 0;if("vertical"===t)if(n){var i=e.parent.children[e.parent.children.length-1].x;r="M 0 "+-1*Math.floor(a/2)+" V"+(i+o/2-e.parent.x)}else r="M 0 "+-1*Math.floor(a/2)+" V"+(e.x+o/2-e.parent.x);else if("horizontal"===t){r="M 0 0H"+(e.y>=e.parent.y?e.y-(e.parent.y+a/2):e.y-(e.parent.y-a/2))}return r},L.getDy=function(e){return s.linkLabelOnTop?"0.35em":Math.ceil(-.5*L.getLinkStrength(e)-3)},L.getInitialDy=function(){return R.select(this).attr("dy")?s.linkLabelOnTop?R.select(this).attr("dy").endsWith("em")?R.select(this).attr("dy"):"0.35em":R.select(this).attr("dy").endsWith("em")?0:R.select(this).attr("dy"):null},L.getLinkStrength=function(e){return e.data?s.linkStrengthStatic?s.linkStrengthValue:s.linkStrengthScale(e.data[s.linkStrengthField]):0},L.getLinkStroke=function(e){return s.linkColorStatic?s.defaultColor:s.linkColorScale(e.data[s.linkColorField])},L.getLinkStrokeWidth=function(e){return L.getLinkStrength(e)+"px"},L.getLinkLabel=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:s.linkLabelField;return s.linkLabelOn&&void 0!==e.data[t]?e.data[t]:""},L.getLinkLabelFormatted=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:s.linkLabelField;return s.linkLabelOn&&void 0!==e.data[t]?isNaN(e.data[t])?e.data[t]:s.linkLabelFormat(e.data[t])+s.linkLabelUnit:""},L.getLinkTextTween=function(e){var t=R.select(this);if(!s.linkLabelOn)return function(){t.text("")};var n=L.getLinkLabel(e,r),a=L.getLinkLabel(e,u);if(!g(n)||!g(a))return function(){t.text(a)};var o=R.interpolateNumber(n,a);return function(e){t.text(s.linkLabelFormat(o(e))+s.linkLabelUnit)}},L.getLinkRTranslate=function(e){return"translate("+(e.y>=e.parent.y?L.getLinkStrength(e.parent)/2:-1*L.getLinkStrength(e.parent)/2)+" "+(e.x-e.parent.x)+")"},L.getLinkLabelColor=function(e){return s.linkLabelColor?s.linkLabelColor(L.getLinkLabel(e,r)):R.select(this).style("fill")},L.getLinkTextPositionX=function(e){return"aligned"===s.linkLabelAlignment?e.linkLabelPos:(e.y-e.parent.y)/2},L.getLinkLabelAnchor=function(e){return"aligned"===s.linkLabelAlignment?e.linkLabelAnchor:s.linkLabelAlignment},L.setupLabelDimensions=function(e){var t=function(e){var t=[],r=new Map,i=new Map,l=void 0;return e.each(function(e){var t={},n=R.select(this).node().getBBox().height,a=R.select(this).node().getBBox().width,o=R.select(this).text();l=e.y>=e.parent.y?r:i,a<=Math.abs(e.y-e.parent.y)-5&&(l.get(e.parent.id)?((t=l.get(e.parent.id)).maxX<a&&(t.maxX=a,t.maxXText=o),e.y>=e.parent.y&&t.posXCenter>(e.y-e.parent.y)/2?t.posXCenter=(e.y-e.parent.y)/2:e.y<e.parent.y&&t.posXCenter<(e.y-e.parent.y)/2&&(t.posXCenter=(e.y-e.parent.y)/2),t.maxY<n&&(t.maxY=n,t.maxYText=o)):(t.maxX=a,t.minX=a,t.maxY=n,t.maxXText=o,t.maxYText=o,t.posXCenter=(e.y-e.parent.y)/2),l.set(e.parent.id,t))}),t.push(r),t.push(i),t}(e);!function(e,n){var a=void 0;e.each(function(e){var t=R.select(this).node().getBBox().width;a=e.y>=e.parent.y?n[0]:n[1],e.linkLabelAnchor="end",e.linkLabelAlways=!0,t<=Math.abs(e.y-e.parent.y)-5?e.linkLabelPos=a.get(e.parent.id).posXCenter+a.get(e.parent.id).maxX/2:(e.linkLabelAlways=!1,e.y>=e.parent.y?e.linkLabelPos=e.y-e.parent.y-10:(e.linkLabelPos=e.y-e.parent.y+10,e.linkLabelAnchor="start"))})}(e,t),s.debugOn&&(console.log("dimensions:"),console.log(t))};var S={},h=void 0,f=void 0,p=void 0;S.initialize=function(e){f=p,p=(h=e).nodeBarOn?h.nodeBarLabel:void 0},S.appendNode=function(e){h.nodeImageFile?S.appendNodeImage(e):h.nodeImageSelectionAppend&&"function"==typeof h.nodeImageSelectionAppend?h.nodeImageSelectionAppend(e):S.appendNodeSVG(e)},S.updateNode=function(e){if(h.nodeImageFile)S.updateNodeImage(e);else if(h.nodeImageSelectionUpdate&&"function"==typeof h.nodeImageSelectionUpdate)h.nodeImageSelectionUpdate(e);else{if(h.nodeImageSelectionAppend&&"function"==typeof h.nodeImageSelectionAppend)return;S.updateNodeSVG(e)}},S.appendNodeSVG=function(e){e.append("rect").attr("class","node-image").attr("x",-5).attr("y",-5).attr("width",10).attr("height",10);var t=e;t.append("line").attr("class",function(e){return e._children?"cross node-image":"cross invisible"}).attr("x1",0).attr("y1",-5).attr("x2",0).attr("y2",5),t.append("line").attr("class",function(e){return e._children?"cross node-image":"cross invisible"}).attr("x1",-5).attr("y1",0).attr("x2",5).attr("y2",0)},S.updateNodeSVG=function(e){e.selectAll("line.cross").attr("class",function(e){return e._children?"cross node-image":"cross invisible"})},S.appendNodeImage=function(e){if(h.nodeImageSetBackground){var t=R.select("div.chart").style("background-color");e.append("rect").attr("width",h.nodeImageWidth).attr("height",h.nodeImageHeight).attr("x",h.nodeImageX).attr("y",h.nodeImageY).style("stroke",t).style("fill",t)}e.append("image").attr("class","node-image").attr("xlink:href",h.nodeImageFileAppend).attr("width",h.nodeImageWidth).attr("height",h.nodeImageHeight).attr("x",h.nodeImageX).attr("y",h.nodeImageY)},S.updateNodeImage=function(e){e.select(".node-image").attr("xlink:href",h.nodeImageFileAppend)},S.computeNodeExtend=function(e){var t,o=[],r=L;r.initialize(h);var n=e.filter(function(e){return void 0!==e.data[p]});n.each(function(e){var t=R.select(this).select(".node-label").node().getBBox(),n=R.select(this).select(".node-image").node().getBBox(),a=0!==t.width?t.x+t.width:n.x+n.width;e.nodeBar={},e.nodeBar.connectorStart=!e.parent||e.y>=e.parent.y?a+5:e.parent.y-e.y+r.getLinkStrength(e.parent,h)/2+5,e.nodeBar.labelWidth=k(e.data[p]),o.push(y(e,e.y+e.nodeBar.connectorStart)),h.debugOn&&console.log("connctorStart: "+e.nodeBar.connectorStart)}),o.anchor=Math.max.apply(Math,o),t=o.anchor+h.nodeBarTranslateX,h.debugOn&&(console.log("alignmentAnchorArray: "+o),console.log("options.nodeBarRange[1]: "+h.nodeBarRange[1]),console.log("anchorXPos: "+t)),n.each(function(e){e.nodeBar.anchor=t-e.y,e.nodeBar.negStart=e.nodeBar.anchor-h.nodeBarRange[1]/2,e.data[h.nodeBarField]<0?h.nodeBarLabelInside?(e.nodeBar.textX=e.nodeBar.anchor-5,e.nodeBar.connectorLength=a(e)?e.nodeBar.textX-e.nodeBar.labelWidth-5-e.nodeBar.connectorStart:e.nodeBar.negStart+h.nodeBarScale(e.data[h.nodeBarField])-5-e.nodeBar.connectorStart):(e.nodeBar.textX=e.nodeBar.negStart+h.nodeBarScale(e.data[h.nodeBarField])-5,e.nodeBar.connectorLength=e.nodeBar.textX-e.nodeBar.labelWidth-5-e.nodeBar.connectorStart):(h.nodeBarLabelInside?e.nodeBar.textX=e.nodeBar.anchor+5:e.nodeBar.textX=h.nodeBarNeg?e.nodeBar.negStart+h.nodeBarScale(e.data[h.nodeBarField])+5:e.nodeBar.anchor+h.nodeBarScale(e.data[h.nodeBarField])+5,e.nodeBar.connectorLength=e.nodeBar.anchor-5-e.nodeBar.connectorStart),h.debugOn&&(console.log("connector: "+e.nodeBar.connectorLength),console.log("nodesAPI.getWidthNodeBarRect(d): "+S.getWidthNodeBarRect(e)))})};var a=function(e){return e.nodeBar.labelWidth+5>S.getWidthNodeBarRect(e)},y=function(e,t){return!h.nodeBarLabelInside&&e.data[h.nodeBarField]<0?t+=5+e.nodeBar.labelWidth:h.nodeBarLabelInside&&e.data[h.nodeBarField]<0&&a(e)&&(t+=e.nodeBar.labelWidth+5-S.getWidthNodeBarRect(e)),t+=e.data[h.nodeBarField]<0?5+S.getWidthNodeBarRect(e):5},k=function(e){var t=R.select("g.node").append("text").style("visibility","hidden").attr("class","bar-label temp").text(isNaN(e)?e:h.nodeBarFormat(e)+h.nodeBarUnit),n=t.node().getBBox().width;return t.remove(),n};S.getNodeBarLabelTween=function(t){var n=R.select(this);if(!h.nodeBarOn)return function(){n.text("")};var a=f?t.data[f]:t.data[p],e=t.data[p];if(n.style("text-anchor",function(){return a<0?"end":"start"}),isNaN(a)||isNaN(e))return function(){n.text(e)};if(S.sameBarLabel())return function(){n.text(h.nodeBarFormat(e)+h.nodeBarUnit)};var o=R.interpolateNumber(a,e),r=R.selectAll(".node-bar.box").filter(function(e){return e.id===t.id});return a||r.attr("class",function(){return 0<=e?"node-bar box node-bar-positive":"node-bar box node-bar-negative"}),function(e){var t=o(e);a*t<=0&&(r.attr("class",function(){return 0<=t?"node-bar box node-bar-positive":"node-bar box node-bar-negative"}),n.style("text-anchor",function(){return t<0?"end":"start"})),n.text(h.nodeBarFormat(t)+h.nodeBarUnit)}},S.sameBarLabel=function(){return console.log("sameBarlabel: "+(f===p)),f===p},S.getNodeBarD=function(e){return"M "+(e.nodeBar.connectorLength+e.nodeBar.connectorStart)+" 0 h "+-e.nodeBar.connectorLength},S.getXNodeBarRect=function(e){return h.nodeBarNeg?e.nodeBar.negStart+h.nodeBarScale(Math.min(0,e.data[h.nodeBarField])):e.nodeBar.anchor},S.getWidthNodeBarRect=function(e){return Math.abs(h.nodeBarScale(e.data[h.nodeBarField])-h.nodeBarScale(0))},S.getXNodeBarText=function(e){return e.nodeBar.textX},S.getNodeBarTextFill=function(e){return h.nodeBarTextFill?h.nodeBarTextFill(e):R.select(this).style("fill")},S.getNodeBarRectFill=function(e){return h.nodeBarRectFill?h.nodeBarRectFill(e):null},S.getNodeBarRectStroke=function(e){return h.nodeBarRectStroke?h.nodeBarRectStroke(e):R.select(this).style("stroke")},S.getNodeBarTextAnchor=function(e){return e.data[h.nodeBarField]<0?"end":"start"},S.setNodeBarDefaultClass=function(e){return f&&f!==p?R.select(this).attr("class"):0<=e.data[h.nodeBarField]?"node-bar box node-bar-positive":"node-bar box node-bar-negative"};var x=0;function b(e,t,n){var a={};a.width=n.svgDimensions.width-n.margin.right-n.margin.left,a.height=n.svgDimensions.height-n.margin.top-n.margin.bottom,a.i=0,a.tree=void 0,a.root=void 0,a.svg=void 0,a.counter=0,a.labelDimensions=[],a.svg=e.append("svg").attr("width",a.width+n.margin.right+n.margin.left).attr("height",a.height+n.margin.top+n.margin.bottom).append("g").attr("transform","translate("+n.margin.left+","+n.margin.top+")"),o(n,a,t),B(n,a),function(e,t,n){e.updateLinkWidth=function(){e.linkWidthStatic?t.tree.nodeSize([0,e.linkWidthValue]):B(e,t),F(t.root,e,t)},e.updateScales=function(){B(e,t),F(t.root,e,t)},e.updateAlignLeaves=function(){o(e,t,n),F(t.root,e,t)},e.updateDefault=function(){F(t.root,e,t)}}(n,a,t),F(a.root,n,a)}function o(t,n,e){n.tree=t.alignLeaves?R.cluster():R.tree(),n.tree.size([n.width,n.height]).nodeSize([0,t.linkWidthValue]),n.root=n.tree(e),t.propagate&&n.root.sum(function(e){return e[t.propagateField]}),n.root.each(function(e){e.name=e.id,e.id=n.i,n.i++,t.propagate&&(e.data[t.propagateField]=e.value)}),n.root.x0=n.root.x,n.root.y0=n.root.y,t.propagate&&(t.propagate=!1),t.debugOn&&(console.log("Data:"),console.log(e),console.log("Tree:"),console.log(n.root))}function B(t,e){var n=e.root.descendants();if(t.linkStrengthStatic||t.linkStrengthScale.domain(R.extent(n,function(e){return+e.data[t.linkStrengthField]})).range(t.linkStrengthRange),t.linkWidthStatic||t.linkWidthScale.domain(R.extent(n.slice(1),function(e){return+e.data[t.linkWidthField]})).range(t.linkWidthRange),t.nodeBarOn&&t.nodeBarUpdateScale){var a=void 0;if(t.nodeBarDomain)a=t.nodeBarDomain;else{var o=R.extent(n,function(e){return+e.data[t.nodeBarField]}),r=Math.max(Math.abs(o[0]),Math.abs(o[1]));t.nodeBarNeg=o[0]<0,0<=o[0]&&0<=o[1]?(a=[0,r],t.nodeBarRangeAdjusted&&(t.nodeBarRange=[t.nodeBarRange[0],t.nodeBarRange[1]/2],t.nodeBarRangeAdjusted=!1)):o[0]<0&&o[1]<0?(a=[o[0],0],t.nodeBarRangeAdjusted&&(t.nodeBarRange=[t.nodeBarRange[0],t.nodeBarRange[1]/2],t.nodeBarRangeAdjusted=!1)):(a=[-r,r],t.nodeBarRange=[t.nodeBarRange[0],2*t.nodeBarRangeUpperBound],t.nodeBarRangeAdjusted=!0)}t.nodeBarScale.domain(a).range(t.nodeBarRange).clamp(!0)}}function F(e,n,t){n.nodeResort&&t.root.sort(n.nodeResortFunction);var a=t.tree(t.root),o=[];a.eachBefore(function(e){o.push(e)}),t.height=Math.max(500,o.length*n.linkHeight+n.margin.top+n.margin.bottom);var r=o.slice(1);o.forEach(function(e,t){e.x=t*n.linkHeight,n.linkWidthStatic||0!==t&&(e.y=e.parent.y+n.linkWidthScale(+e.data[n.linkWidthField]))}),R.select("svg").transition().duration(n.transitionDuration).attr("height",t.height);var i=S;i.initialize(n);var l=t.svg.selectAll("g.node").data(o,function(e){return e.id||(e.id=++t.i)}),d=l.enter().append("g").attr("class","node").style("visibility","hidden").on("click",function(e){return function(e,t,n){e.children?(e._children=e.children,e.children=null):(e.children=e._children,e._children=null),t.transitionDuration=t.transitionDurationClick,F(e,t,n),t.transitionDuration=t.transitionDurationDefault}(e,n,t)});d.call(i.appendNode),d.append("text").attr("class","node-label").attr("x",function(e){return!e.parent||e.y>=e.parent.y?n.nodeLabelPadding:-n.nodeLabelPadding}).attr("dy",".35em").attr("text-anchor",function(e){return!e.parent||e.y>=e.parent.y?"start":"end"}).text(function(e){return e.data[n.nodeLabelField].length>n.nodeLabelLength?e.data[n.nodeLabelField].substring(0,n.nodeLabelLength)+"...":e.data[n.nodeLabelField]}),d.append("svg:title").text(function(e){return e.data[n.nodeLabelField]}),d.style("visibility","hidden");var c=d.append("g").attr("class","node-bar").style("display",function(e){return n.nodeBarOn&&null!==e.data[n.nodeBarField]?"inline":"none"});c.append("path").attr("class","node-bar connector").attr("d","M 0 0 h 0"),c.append("rect").attr("class",i.setNodeBarDefaultClass).attr("y",-8).attr("height",16),c.append("text").attr("class","node-bar bar-label").attr("dy",".35em");var s=l.merge(d);s.selectAll("g.node-bar").style("display",function(e){return n.nodeBarOn&&null!==e.data[n.nodeBarField]?"inline":"none"}),n.nodeBarOn&&i.computeNodeExtend(s),d.attr("transform","translate("+e.y0+","+e.x0+") scale(0.001, 0.001)").style("visibility","visible");var u="trans"+x++,g=s.transition(u).duration(n.transitionDuration);console.log("transition: "+u),console.log("nodeUpdate.size: "+g.size()),g.attr("transform",function(e){return"translate("+e.y+","+e.x+") scale(1,1)"}),g.call(i.updateNode),g.selectAll("g.node-bar").attr("display",n.nodeBarOn?"inline":"none"),n.nodeBarOn&&(g.selectAll(".node-bar.box").attr("class",i.setNodeBarDefaultClass).style("fill",i.getNodeBarRectFill).style("stroke",i.getNodeBarRectStroke).attr("x",i.getXNodeBarRect).attr("width",i.getWidthNodeBarRect),g.selectAll(".node-bar.bar-label").style("fill",i.getNodeBarTextFill).call(function(e){return e.tween("nodeBarLabel"+x,i.getNodeBarLabelTween)}).attr("x",i.getXNodeBarText),g.selectAll(".node-bar.connector").attr("d",i.getNodeBarD));var h=l.exit().transition().duration(n.transitionDuration);h.attr("transform",function(){return"translate("+e.y+","+e.x+") scale(0.001, 0.001)"}).remove(),h.select(".node-label").style("fill-opacity",1e-6);var f=L;f.initialize(n);var p=t.svg.selectAll("g.link").data(r,function(e){return e.id+"->"+e.parent.id}),y=p.enter().insert("g","g.node").attr("class","link").attr("transform","translate("+e.y0+" "+e.x0+")"),k={x:e.x0,y:e.y0,parent:{x:e.x0,y:e.y0}};y.filter(function(e){return e.id===e.parent.children[e.parent.children.length-1].id}).lower().append("path").attr("class","link vertical").attr("d",function(){return f.getLinkD(k,"vertical")}),y.append("path").attr("class","link horizontal").attr("d",function(){return f.getLinkD(k,"horizontal")}),y.append("text").style("opacity",1e-6);var b=p.merge(y);b.select("text").attr("class",n.linkLabelOnTop?"label ontop":"label above").attr("dy",f.getInitialDy).text(function(e){return f.getLinkLabelFormatted(e)}).style("fill",f.getLinkLabelColor);var B=b.transition().duration(n.transitionDuration);f.setupLabelDimensions(R.selectAll(".link text.label")),B.attr("transform",function(e){return"translate("+e.parent.y+" "+e.parent.x+")"}),B.select("path.link.vertical").attr("d",function(e){return f.getLinkD(e,"vertical",!0)}).style("stroke",function(e){return n.linkColorInherit?f.getLinkStroke(e.parent):""}).style("stroke-width",function(e){return f.getLinkStrokeWidth(e.parent)}),B.select("path.link.horizontal").attr("d",function(e){return f.getLinkD(e,"horizontal")}).attr("transform",f.getLinkRTranslate).style("stroke",f.getLinkStroke).style("stroke-width",f.getLinkStrokeWidth),B.select("text").attr("dy",f.getDy).attr("text-anchor",f.getLinkLabelAnchor).attr("x",f.getLinkTextPositionX).attr("y",function(e){return e.x-e.parent.x}).call(function(e){return e.tween("text",f.getLinkTextTween)}).style("opacity",function(e){return n.linkLabelAlways||e.linkLabelAlways?1:0});var v=p.exit().transition().duration(n.transitionDuration).remove();v.attr("transform","translate("+e.y+" "+e.x+")");var m={x:e.x,y:e.y,parent:{x:e.x,y:e.y}};v.selectAll("path.link.vertical").attr("d",function(){return f.getLinkD(m,"vertical")}),v.selectAll("path.link.horizontal").attr("d",function(){return f.getLinkD(m,"horizontal")}).attr("transform","translate(0 0)"),v.select("text").attr("x",0).attr("y",0).style("opacity",1e-6),o.forEach(function(e){e.x0=e.x,e.y0=e.y})}e.chart=function(n){var a={};function o(t){t.each(function(e){(console.log(e),console.log("dataSpec: "),console.log(n),void 0!==e)?r(t,e):l(function(n){var e={};if("object"===(void 0===n?"undefined":i(n))){if(e.data=n.source,e.hierarchyLevels=n.hierarchyLevels,e.flatData=!!Array.isArray(e.hierarchyLevels),e.keyField=n.key?n.key:"key",e.delimiter=n.delimiter?n.delimiter:",",e.separator=n.separator?n.separator:"$",e.autoConvert=!0,e.convertTypesFunction=R.autoType,"none"===n.convertTypes)e.autoConvert=!1;else if("function"==typeof n.convertTypes)if(e.flatData){e.convertTypesFunction=function(e){var t=n.convertTypes(e);return t.key=e.key,t.parent=e.parent,t.__he_name=e.__he_name,t}}else e.convertTypesFunction=n.convertTypes}else console.log("dataspec is not an object!");e.isJSON="object"===i(e.data),e.isJSON||(e.fromFile=!(!e.data.endsWith(".json")&&!e.data.endsWith(".csv")));return a.keyField=e.keyField,a.nodeLabelField=e.flatData?a.nodeLabelFieldFlatData:e.keyField,e}(n),t,a,r)})}function r(e,t){b(e,t,a)}return a.debugOn=!1,a.margin={top:20,right:10,bottom:20,left:10},a.svgDimensions={height:800,width:1400},a.transitionDurationDefault=750,a.transitionDurationClick=750,a.transitionDuration=a.transitionDurationDefault,a.locale=void 0,a.defaultColor="grey",a.nodeBarOn=!1,a.nodeBarField="value",a.nodeBarLabel=a.nodeBarField,a.nodeBarLabelInside=!1,a.nodeBarUnit="",a.nodeBarFormatSpecifier=",.0f",a.nodeBarFormat=R.format(a.nodeBarFormatSpecifier),a.nodeBarScale=R.scaleLinear(),a.nodeBarRange=[0,200],a.nodeBarRangeUpperBound=a.nodeBarRange[1],a.nodeBarRangeAdjusted=!1,a.nodeBarUpdateScale=!0,a.nodeBarTranslateX=50,a.nodeBarState={},a.nodeImageFile=!1,a.nodeImageFileAppend=void 0,a.nodeImageSetBackground=!1,a.nodeImageWidth=10,a.nodeImageHeight=10,a.nodeImageX=a.nodeImageWidth/2,a.nodeImageY=a.nodeImageHeight/2,a.nodeImageSelectionAppend=void 0,a.nodeImageSelectionUpdate=void 0,a.nodeLabelField=void 0,a.nodeLabelFieldFlatData="__he_name",a.nodeLabelLength=50,a.nodeLabelPadding=10,a.nodeResort=!1,a.nodeResortAscending=!1,a.nodeResortField="value",a.nodeResortByHeight=!1,a.nodeResortFunction=function(e,t){var n=a.nodeResortByHeight?t.height-e.height:0;return 0===n&&(n="string"==typeof e.data[a.nodeResortField]?t.data[a.nodeResortField].localeCompare(e.data[a.nodeResortField]):t.data[a.nodeResortField]-e.data[a.nodeResortField]),a.nodeResortAscending&&(n*=-1),n},a.linkHeight=20,a.linkLabelField="value",a.linkLabelOn=!1,a.linkLabelUnit="",a.linkLabelOnTop=!0,a.linkLabelAlignment="aligned",a.linkLabelAlways=!1,a.linkLabelFormatSpecifier=",.0f",a.linkLabelFormat=R.format(a.linkLabelFormatSpecifier),a.linkWidthStatic=!0,a.linkWidthValue=30,a.linkWidthScale=R.scaleLinear(),a.linkWidthField="value",a.linkWidthRange=[15,100],a.linkStrengthStatic=!0,a.linkStrengthValue=1,a.linkStrengthScale=R.scaleLinear(),a.linkStrengthField="value",a.linkStrengthRange=[1,10],a.linkColorStatic=!0,a.linkColorScale=function(e){return e},a.linkColorField="color",a.linkColorInherit=!0,a.propagate=!1,a.propagateField="value",a.alignLeaves=!1,a.keyField="key",o.debugOn=function(e){return arguments.length?(a.debugOn=e,o):a.debugOn},o.defaultColor=function(e){return arguments.length?(a.defaultColor=e,"function"==typeof a.updateLinkColor&&a.updateLinkColor(),o):a.defaultColor},o.margin=function(e){return arguments.length?(a.margin=e,o):a.margin},o.svgDimensions=function(e){return arguments.length?(a.svgDimensions=e,o):a.svgDimensions},o.nodeLabelLength=function(e){return arguments.length?(a.nodeLabelLength=e,o):a.nodeLabelLength},o.nodeLabelPadding=function(e){return arguments.length?(a.nodeLabelPadding=e,o):a.nodeLabelPadding},o.transitionDuration=function(e){return arguments.length?(a.transitionDurationDefault=e,a.transitionDuration=e,o):a.transitionDuration},o.propagateValue=function(e){return arguments.length?(a.propagate=!0,a.propagateField=e,o):a.propagate+": "+a.propagateField},o.formatDefaultLocale=function(e){return arguments.length?("DE"===e&&(e={decimal:",",thousands:".",grouping:[3],currency:[""," â‚¬"]}),a.locale=R.formatDefaultLocale(e),o):a.locale},o.nodeBar=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:a.nodeBarField,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return arguments.length?("string"==typeof e?(a.nodeBarField=e,a.nodeBarOn=!0):"boolean"==typeof e&&(a.nodeBarOn=e),a.nodeBarOn&&(t.locale&&o.formatDefaultLocale(t.locale),a.nodeBarLabel=t.label||a.nodeBarField,a.nodeBarState.oldField=a.nodeBarState.newField,a.nodeBarState.newField=a.nodeBarLabel,a.nodeBarLabelInside=void 0!==t.labelInside?t.labelInside:a.nodeBarLabelInside,a.nodeBarTextFill=t.textFill||a.nodeBarTextFill,a.nodeBarRectFill=t.rectFill||a.nodeBarRectFill,a.nodeBarRectStroke=t.rectStroke||a.nodeBarRectStroke,a.nodeBarUnit=t.unit||a.nodeBarUnit,a.nodeBarFormat=t.format?R.format(t.format):a.nodeBarFormat,a.nodeBarTranslateX=t.translateX||a.nodeBarTranslateX,a.nodeBarScale=t.scale||a.nodeBarScale,t.range&&(a.nodeBarRange=t.range,a.nodeBarRangeAdjusted=!1),t.range&&(a.nodeBarRangeUpperBound=a.nodeBarRange[1]),a.nodeBarDomain=t.domain||a.nodeBarDomain,void 0!==t.updateScale&&(a.nodeBarUpdateScale=t.updateScale)),"function"==typeof a.updateScales&&a.updateScales(),o):a.nodeBarField},o.nodeImageFile=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return arguments.length?(a.nodeImageFile=!0,a.nodeImageFileAppend=e,a.nodeImageWidth=t.width||a.nodeImageWidth,a.nodeImageHeight=t.height||a.nodeImageHeight,a.nodeImageX=t.x||-1*a.nodeImageWidth/2,a.nodeImageY=t.y||-1*a.nodeImageHeight/2,a.nodeImageSetBackground=t.setBackground||a.nodeImageSetBackground,"function"==typeof a.updateDefault&&a.updateDefault(),o):a.nodeImageFileAppend},o.nodeImageSelection=function(e,t){return arguments.length?(a.nodeImageSelectionAppend=!1===e?function(){}:e,a.nodeImageSelectionUpdate=t,a.nodeImageFile=!1,"function"==typeof a.updateDefault&&a.updateDefault(),o):a.nodeImageSelectionAppend},o.nodeSort=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:a.nodeSortField,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return arguments.length?("string"==typeof e&&(a.nodeResort=!0,a.nodeResortAscending=void 0!==t.ascending?t.ascending:a.nodeResortAscending,a.nodeResortByHeight=void 0!==t.sortByHeight?t.sortByHeight:a.nodeResortByHeight,a.nodeResortField=e),"function"==typeof a.updateDefault&&a.updateDefault(),o):a.nodeSortField},o.linkHeight=function(e){return arguments.length?(a.linkHeight=e,"function"==typeof a.updateDefault&&a.updateDefault(),o):a.linkHeight},o.linkLabel=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:a.linkLabelField,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return arguments.length?("string"==typeof e?(a.linkLabelField=e,a.linkLabelOn=!0):"boolean"==typeof e&&(a.linkLabelOn=e),a.linkLabelOn&&(t.locale&&o.formatDefaultLocale(t.locale),a.linkLabelColor=t.color||a.linkLabelColor,a.linkLabelUnit=t.unit||a.linkLabelUnit,a.linkLabelFormat=t.format?R.format(t.format):a.linkLabelFormat,a.linkLabelOnTop=void 0!==t.onTop?t.onTop:a.linkLabelOnTop,a.linkLabelAlways=void 0!==t.always?t.always:a.linkLabelAlways,a.linkLabelAlignment=t.align||a.linkLabelAlignment),"function"==typeof a.updateDefault&&a.updateDefault(),o):a.linkLabelField},o.linkWidth=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:a.linkWidthField,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return arguments.length?("number"==typeof e?(a.linkWidthStatic=!0,a.linkWidthValue=e):"string"==typeof e&&(a.linkWidthStatic=!1,a.linkWidthField=e,a.linkWidthScale=t.scale||a.linkWidthScale,a.linkWidthRange=t.range||a.linkWidthRange),"function"==typeof a.updateLinkWidth&&a.updateLinkWidth(),o):a.linkWidthValue},o.linkStrength=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:a.linkStrengthField,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return arguments.length?("number"==typeof e?(a.linkStrengthStatic=!0,a.linkStrengthValue=e):"string"==typeof e&&(a.linkStrengthStatic=!1,a.linkStrengthField=e,a.linkStrengthScale=t.scale||a.linkStrengthScale,a.linkStrengthRange=t.range||a.linkStrengthRange),"function"==typeof a.updateScales&&a.updateScales(),o):a.linkStrengthValue},o.linkColor=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:a.linkColorField,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return arguments.length?(a.linkColorStatic=!1,a.linkColorField=e,a.linkColorScale=t.scale||a.linkColorScale,a.linkColorInherit=void 0!==t.inherit?t.inherit:a.linkColorInherit,"function"==typeof a.updateDefault&&a.updateDefault(),o):a.linkColorField},o.alignLeaves=function(e){return arguments.length?(a.alignLeaves=e,"function"==typeof a.updateAlignLeaves&&a.updateAlignLeaves(),o):a.alignLeaves},o},Object.defineProperty(e,"__esModule",{value:!0})});