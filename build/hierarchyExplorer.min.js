!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3")):"function"==typeof define&&define.amd?define(["exports","d3"],e):e(t.hierarchyExplorer={},t.d3)}(this,function(t,m){"use strict";function o(n,i,l,a){if(n.fromFile)n.data.endsWith(".json")?m.json(n.data).then(function(t){l&&(console.log("Initial Data: "),console.log(t));var e=m.hierarchy(t);l&&(console.log("hierarchy: "),console.log(e)),a(i,e)}):n.data.endsWith(".csv")?n.flatData?m.dsv(n.delimiter,n.data).then(function(t){l&&console.log(t);var e=d(t,n.hierarchyLevels,n.keyField,l);l&&(console.log("hierarchy: "),console.log(e)),a(i,e)}):m.dsv(n.delimiter,n.data).then(function(t){l&&console.log(t);var e=r(t,n.keyField);l&&(console.log("hierarchy: "),console.log(e)),a(i,e)}):console.log("File must end with .json or .csv");else{var t=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"aside#data",n=m.select(e).text().trim();return m.dsvFormat(t).parse(n)}(n.delimiter,n.data),e=n.flatData?d(t,n.hierarchyLevels,n.keyField,l):r(t,n.keyField);l&&(console.log("embedded data: "),console.log(e)),a(i,e)}}function r(t,e){return m.stratify().id(function(t){return t[e]}).parentId(function(t){return t.parent})(t)}function d(t,e,n,i){var l=m.nest();e.forEach(function(e){return l.key(function(t){return t[e]})}),l=l.map(t);var a={};return a[n]=l.keys()[0],function n(i,t,l){if(Array.isArray(t)){var e=t[0];for(var a in e)i[a]=e[a]}else t.entries().forEach(function(t){if(""===t[l])n(i,t.value);else{i.children=i.children?i.children:[];var e={};e[l]=t[l],i.children.push(n(e,t.value,l))}});return i}(a,l.get(l.keys()[0]),n),i&&(console.log("converted JSON:"),console.log(a)),m.hierarchy(a)}var L={},c=void 0,a=void 0,u=void 0,n=void 0;function i(t,e,n){var i,l,a,r={};r.width=n.svgDimensions.width-n.margin.right-n.margin.left,r.height=n.svgDimensions.height-n.margin.top-n.margin.bottom,r.i=0,r.tree=void 0,r.root=void 0,r.svg=void 0,r.counter=0,r.labelDimensions=[],r.svg=t.append("svg").attr("width",r.width+n.margin.right+n.margin.left).attr("height",r.height+n.margin.top+n.margin.bottom).append("g").attr("transform","translate("+n.margin.left+","+n.margin.top+")"),g(n,r,e),s(n,r),l=r,a=e,(i=n).updateLinkWidth=function(){i.linkWidthStatic?l.tree.nodeSize([0,i.linkWidthValue]):s(i,l),v(l.root,i,l)},i.updateLinkStrength=function(){s(i,l),v(l.root,i,l)},i.updateAlignLeaves=function(){g(i,l,a),v(l.root,i,l)},i.updateDefault=function(){v(l.root,i,l)},v(r.root,n,r)}function g(e,n,t){n.tree=e.alignLeaves?m.cluster():m.tree(),n.tree.size([n.width,n.height]).nodeSize([0,e.linkWidthValue]),n.root=n.tree(t),e.propagate&&n.root.sum(function(t){return t[e.propagateField]}),n.root.each(function(t){t.name=t.id,t.id=n.i,n.i++,e.propagate&&(t.data[e.propagateField]=t.value)}),n.root.x0=n.root.x,n.root.y0=n.root.y,e.propagate&&(e.propagate=!1),e.debugOn&&(console.log("Data:"),console.log(t),console.log("Tree:"),console.log(n.root))}function s(e,t){var n=t.root.descendants();e.linkStrengthStatic||e.linkStrengthScale.domain(m.extent(n,function(t){return+t.data[e.linkStrengthField]})).range(e.linkStrengthRange),e.linkWidthStatic||e.linkWidthScale.domain(m.extent(n.slice(1),function(t){return+t.data[e.linkWidthField]})).range(e.linkWidthRange)}function v(t,l,a){var e=a.tree(a.root),n=[];e.eachBefore(function(t){n.push(t)}),a.height=Math.max(500,n.length*l.linkHeight+l.margin.top+l.margin.bottom);var i=n.slice(1);n.forEach(function(t,e){t.x=e*l.linkHeight,l.linkWidthStatic||0!==e&&(t.y=t.parent.y+l.linkWidthScale(+t.data[l.linkWidthField]))}),m.select("svg").transition().duration(l.transitionDuration).attr("height",a.height);var r=a.svg.selectAll("g.node").data(n,function(t){return t.id||(t.id=++a.i)}),o=r.enter().append("g").attr("class","node").attr("transform",function(){return"translate("+t.y0+","+t.x0+")"}).on("click",function(t){return n=l,i=a,(e=t).children?(e._children=e.children,e.children=null):(e.children=e._children,e._children=null),void v(e,n,i);var e,n,i});o.append("circle").attr("r",1e-6).style("fill",function(t){return t._children?"lightsteelblue":"#fff"}),o.append("text").attr("x",10).attr("dy",".35em").attr("text-anchor","start").text(function(t){return t.data[l.keyField].length>l.maxNameLength?t.data[l.keyField].substring(0,l.maxNameLength)+"...":t.data[l.keyField]}).style("fill-opacity",1e-6),o.append("svg:title").text(function(t){return t.data[l.keyField]});var d=r.merge(o).transition().duration(l.transitionDuration);d.attr("transform",function(t){return"translate("+t.y+","+t.x+")"}),d.select("circle").attr("r",4.5).style("fill",function(t){return t._children?"lightsteelblue":"#fff"}),d.select("text").style("fill-opacity",1);var c=r.exit().transition().duration(l.transitionDuration);c.attr("transform",function(){return"translate("+t.y+","+t.x+")"}).remove(),c.select("circle").attr("r",1e-6),c.select("text").style("fill-opacity",1e-6);var u=L;u.initialize(l);var g=a.svg.selectAll("g.link").data(i,function(t){return t.id+"->"+t.parent.id}),s=g.enter().insert("g","g.node").attr("class","link").attr("transform","translate("+t.y0+" "+t.x0+")"),h={x:t.x0,y:t.y0,parent:{x:t.x0,y:t.y0}};s.append("path").attr("class","link down").attr("d",function(){return u.getLinkD(h,"down")}),s.append("path").attr("class","link right").attr("d",function(){return u.getLinkD(h,"right")}),s.append("text").style("opacity",1e-6);var f=g.merge(s);f.select("text").attr("class",l.linkLabelOnTop?"label ontop":"label above").attr("text-anchor",l.linkLabelAligned?"end":"middle").attr("dy",u.getInitialDy).text(function(t){return u.getLinkLabelFormatted(t)}).style("fill",u.getLinkLabelColor);var k=f.transition().duration(l.transitionDuration);u.computeLabelDimensions(k.selectAll("text.label")),k.attr("transform",function(t){return"translate("+t.parent.y+" "+t.parent.x+")"}),k.select("path.link.down").attr("d",function(t){return u.getLinkD(t,"down")}).style("stroke",function(t){return u.getLinkStroke(t.parent)}).style("stroke-width",function(t){return u.getLinkStrokeWidth(t.parent)}),k.select("path.link.right").attr("d",function(t){return u.getLinkD(t,"right")}).attr("transform",u.getLinkRTranslate).style("stroke",u.getLinkStroke).style("stroke-width",u.getLinkStrokeWidth),k.select("text").attr("dy",u.getDy).attr("x",u.getLinkTextPositionX).attr("y",function(t){return t.x-t.parent.x}).call(function(t){return t.tween("text",u.getLinkTextTween)}).style("opacity",1);var p=g.exit().transition().duration(l.transitionDuration).remove();p.attr("transform","translate("+t.y+" "+t.x+")");var y={x:t.x,y:t.y,parent:{x:t.x,y:t.y}};p.selectAll("path.link.down").attr("d",function(){return u.getLinkD(y,"down")}),p.selectAll("path.link.right").attr("d",function(){return u.getLinkD(y,"right")}).attr("transform","translate(0 0)"),p.select("text").attr("x",0).attr("y",0).style("opacity",1e-6),n.forEach(function(t){t.x0=t.x,t.y0=t.y})}L.initialize=function(t){a=u,u=(c=t).linkLabelOn?c.linkLabelField:void 0,c.debugOn&&(console.log("oldLabel:"),console.log(a),console.log("newLabel:"),console.log(u))},L.getLinkD=function(t,e){var n=L.getLinkStrength(t.parent,c),i=L.getLinkStrength(t,c),l=void 0;return"down"===e?l="M 0 0V"+(t.x+i/2-t.parent.x):"right"===e&&(l="M 0 0H"+(t.y-(t.parent.y+n/2))),l},L.getDy=function(t){return c.linkLabelOnTop?"0.35em":Math.ceil(-.5*L.getLinkStrength(t)-3)},L.getInitialDy=function(){return m.select(this).attr("dy")?c.linkLabelOnTop?m.select(this).attr("dy").endsWith("em")?m.select(this).attr("dy"):"0.35em":m.select(this).attr("dy").endsWith("em")?0:m.select(this).attr("dy"):null},L.getLinkStrength=function(t){return t.data?c.linkStrengthStatic?c.linkStrengthValue:c.linkStrengthScale(t.data[c.linkStrengthField]):0},L.getLinkStroke=function(t){return c.linkColorStatic?c.defaultColor:c.linkColorScale(t.data[c.linkColorField])},L.getLinkStrokeWidth=function(t){return L.getLinkStrength(t)+"px"},L.getLinkLabel=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:c.linkLabelField;return c.linkLabelOn?t.data[e]:""},L.getLinkLabelFormatted=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:c.linkLabelField;return c.linkLabelOn?c.linkLabelFormat(t.data[e])+c.linkLabelUnit:""},L.getLinkTextTween=function(t){var e=m.select(this);if(!c.linkLabelOn)return function(){e.text("")};var n=L.getLinkLabel(t,a),i=L.getLinkLabel(t,u),l=m.interpolateNumber(n,i);return function(t){e.text(c.linkLabelFormat(l(t))+c.linkLabelUnit)}},L.getLinkRTranslate=function(t){return"translate("+L.getLinkStrength(t.parent)/2+" "+(t.x-t.parent.x)+")"},L.getLinkLabelColor=function(t){return c.linkLabelColor?c.linkLabelColor(L.getLinkLabel(t,a)):m.select(this).style("fill")},L.getLinkTextPositionX=function(t){var e=c.linkLabelAligned?n[t.depth].maxX/2:0;return(t.y-t.parent.y)/2+e},L.computeLabelDimensions=function(t){var a=[void 0];t.each(function(t){var e={},n=m.select(this).node().getBBox().height,i=m.select(this).node().getBBox().width,l=m.select(this).text();a[t.depth]?(a[t.depth].maxX<i&&(a[t.depth].maxX=i,a[t.depth].maxXText=l),a[t.depth].maxY<n&&(a[t.depth].maxY=n,a[t.depth].maxYText=l)):(e.maxX=i,e.maxY=n,e.maxXText=l,e.maxYText=l,a.push(e))}),n=a,c.debugOn&&(console.log("dimensions:"),console.log(a))};var h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};t.chart=function(l){var a={};function n(i){i.each(function(t){var e,n;console.log(t),console.log("dataSpec: "),console.log(l),void 0!==t?r(i,t):o((n={},"object"===(void 0===(e=l)?"undefined":h(e))?(n.data=e.source,n.hierarchyLevels=e.hierarchyLevels,n.keyField=e.key?e.key:"key",n.delimiter=e.delimiter?e.delimiter:","):console.log("dataspec is not an object!"),n.fromFile=!(!n.data.endsWith(".json")&&!n.data.endsWith(".csv")),n.flatData=!!Array.isArray(n.hierarchyLevels),a.keyField=n.keyField,n),i,a.debugOn,r)})}function r(t,e){i(t,e,a)}return a.debugOn=!1,a.margin={top:20,right:10,bottom:20,left:10},a.svgDimensions={height:800,width:1400},a.maxNameLength=50,a.transitionDuration=750,a.defaultColor="grey",a.linkHeight=20,a.linkLabelField="value",a.linkLabelOn=!1,a.linkLabelUnit="",a.linkLabelOnTop=!0,a.linkLabelAligned=!0,a.locale=void 0,a.linkLabelFormatSpecifier=",.0f",a.linkLabelFormat=m.format(a.linkLabelFormatSpecifier),a.linkWidthStatic=!0,a.linkWidthValue=30,a.linkWidthScale=m.scaleLinear(),a.linkWidthField="value",a.linkWidthRange=[15,100],a.linkStrengthStatic=!0,a.linkStrengthValue=1,a.linkStrengthScale=m.scaleLinear(),a.linkStrengthField="value",a.linkStrengthRange=[1,10],a.linkColorStatic=!0,a.linkColorScale=function(t){return t},a.linkColorField="color",a.propagate=!1,a.propagateField="value",a.alignLeaves=!1,a.keyField="key",n.debugOn=function(t){return arguments.length?(a.debugOn=t,n):a.debugOn},n.defaultColor=function(t){return arguments.length?(a.defaultColor=t,"function"==typeof a.updateLinkColor&&a.updateLinkColor(),n):a.defaultColor},n.margin=function(t){return arguments.length?(a.margin=t,n):a.margin},n.svgDimensions=function(t){return arguments.length?(a.svgDimensions=t,n):a.svgDimensions},n.maxNameLength=function(t){return arguments.length?(a.maxNameLength=t,n):a.maxNameLength},n.transitionDuration=function(t){return arguments.length?(a.transitionDuration=t,n):a.transitionDuration},n.propagateValue=function(t){return arguments.length?(a.propagate=!0,a.propagateField=t,n):a.propagate+": "+a.propagateField},n.formatDefaultLocale=function(t){return arguments.length?("DE"===t&&(t={decimal:",",thousands:".",grouping:[3],currency:[""," â‚¬"]}),a.locale=m.formatDefaultLocale(t),n):a.locale},n.linkHeight=function(t){return arguments.length?(a.linkHeight=t,"function"==typeof a.updateDefault&&a.updateDefault(),n):a.linkHeight},n.linkLabel=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:a.linkLabelField,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return arguments.length?("string"==typeof t?(a.linkLabelField=t,a.linkLabelOn=!0):"boolean"==typeof t&&(a.linkLabelOn=t),a.linkLabelOn&&(e.locale&&n.formatDefaultLocale(e.locale),a.linkLabelColor=e.color||a.linkLabelColor,a.linkLabelUnit=e.unit||a.linkLabelUnit,a.linkLabelFormat=e.format?m.format(e.format):a.linkLabelFormat,a.linkLabelOnTop=void 0!==e.onTop?e.onTop:a.linkLabelOnTop,a.linkLabelAligned=void 0!==e.align?e.align:a.linkLabelAligned),"function"==typeof a.updateDefault&&a.updateDefault(),n):a.linkLabelField},n.linkWidth=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:a.linkWidthField,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return arguments.length?("number"==typeof t?(a.linkWidthStatic=!0,a.linkWidthValue=t):"string"==typeof t&&(a.linkWidthStatic=!1,a.linkWidthField=t,a.linkWidthScale=e.scale||a.linkWidthScale,a.linkWidthRange=e.range||a.linkWidthRange),"function"==typeof a.updateLinkWidth&&a.updateLinkWidth(),n):a.linkWidthValue},n.linkStrength=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:a.linkStrengthField,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return arguments.length?("number"==typeof t?(a.linkStrengthStatic=!0,a.linkStrengthValue=t):"string"==typeof t&&(a.linkStrengthStatic=!1,a.linkStrengthField=t,a.linkStrengthScale=e.scale||a.linkStrengthScale,a.linkStrengthRange=e.range||a.linkStrengthRange),"function"==typeof a.updateLinkStrength&&a.updateLinkStrength(),n):a.linkStrengthValue},n.linkColor=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:a.linkColorField,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:a.linkColorScale;return arguments.length?(a.linkColorStatic=!1,a.linkColorField=t,a.linkColorScale=e,"function"==typeof a.updateDefault&&a.updateDefault(),n):a.linkColorField},n.alignLeaves=function(t){return arguments.length?(a.alignLeaves=t,"function"==typeof a.updateAlignLeaves&&a.updateAlignLeaves(),n):a.alignLeaves},n},Object.defineProperty(t,"__esModule",{value:!0})});